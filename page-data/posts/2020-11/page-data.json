{"componentChunkName":"component---src-post-template-js","path":"/posts/2020-11","result":{"data":{"markdownRemark":{"html":"<h3><a href=\"https://medium.com/dailyjs/we-rendered-a-million-web-pages-to-learn-how-the-web-breaks-fdf12f5c505a\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">We rendered a million web pages to learn how the web breaks</a></h3>\n<ul>\n<li>共有者:b4h0_c4t</li>\n</ul>\n<p>Webページがどのようにして壊れるかを学ぶため、実際に発生しているエラーを調査、考察した記事。</p>\n<p>トップ100ドメインのルートページ100万件をレンダリングするスクリプトを使用して出力される未処理エラーを調査した結果、85%が <code class=\"language-text\">ReferenceError</code> <code class=\"language-text\">TypeError</code> <code class=\"language-text\">SyntaxError</code> 。\nまた、上記のエラーが実際に発生している理由として、そのほとんどがリソースの読み込み失敗に起因していると述べています。</p>\n<ul>\n<li>\n<p>How to resolve ReferenceError</p>\n<ul>\n<li>ReferenceErrorの多くはライブラリが生成したグローバル変数を読み込む時に発生している。</li>\n</ul>\n</li>\n<li>\n<p>What causes TypeError on live web site?</p>\n<ul>\n<li>TypeErrorの97%はnullもしくはundefinedに起因している。</li>\n</ul>\n</li>\n<li>\n<p>What causes SyntaxError on live web site?</p>\n<ul>\n<li>開発中に遭遇するSyntaxErrorのほとんどはtypo。デプロイされているWebサイトの場合はほとんどがネットワーク障害かJSのプログラム生成の失敗に起因している。</li>\n</ul>\n</li>\n</ul>\n<p>ほとんどのエラーと強く関連しているコードは <code class=\"language-text\">webpack</code> で、サンプルにしたWebページの12%が1件以上のエラーを発生させている。</p>\n<p>エラーの出にくいWebサイトを作るためには静的検査が欲しいが、遅延バインディングの必要性もあってなかなか難しい。\nその点、TypeScriptは検査時と実行時で性質を完全に分離しているので良いトレードオフかもしれない。\n最近はWebAssemblyが登場し、JSレスで静的検査に寄せられる土台ができつつあるが、実行時にランタイム外との対話が必要なことにわ変わりなさそう。</p>\n<p>ランタイムの動的性質を許可しつつ、部分的に静的検査によって安全性を担保することが壊れにくいWebページを作る鍵になるかもしれないと締めていました。</p>\n<hr>\n<h3><a href=\"https://github.com/microsoft/TypeScript/wiki/Performance\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Performance · microsoft/TypeScript Wiki</a></h3>\n<ul>\n<li>共有者:sakito</li>\n</ul>\n<p>この wiki 自体は TypeScript チームがコンパイル速度や実装の体験をよくするための情報として、去年ごろに公開していました。</p>\n<p>今年の秋ごろ<a href=\"https://github.com/microsoft/TypeScript/wiki/Performance#writing-easy-to-compile-code\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">「Writing Easy-to-Compile Code」</a>の項目が追加されています。\nこの項目はコンパイルパフォーマンスがいい書き方を示してくれています。</p>\n<p>項目は下記 3 つに別れています。</p>\n<ul>\n<li>\n<p><a href=\"https://github.com/microsoft/TypeScript/wiki/Performance#writing-easy-to-compile-code\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Preferring Interfaces Over Intersections</a></p>\n<ul>\n<li>Type を使った Intersection Types よりも interface の extends のほうがいいとのこと。</li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://github.com/microsoft/TypeScript/wiki/Performance#using-type-annotations\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Using Type Annotations</a></p>\n<ul>\n<li>関数の戻り値の型は、明示的に型を定義したほうがコンパイル時間の節約になる。型推論は便利なので、コンパイルのボトルネックとなってる場合には試してねとのこと。</li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://github.com/microsoft/TypeScript/wiki/Performance#using-type-annotations\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Preferring Base Types Over Unions</a></p>\n<ul>\n<li>Union Type を使用するよりも sub types を使った方がよいとのこと(例のコードを見た方がわかりやすい)</li>\n</ul>\n</li>\n</ul>\n<p>interface と Type に関する記事は最近<a href=\"https://ncjamieson.com/prefer-interfaces/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">「TypeScript: Prefer Interfaces」</a>も出ており、\nType はインライン化されるので d.ts のサイズが肥大化するから interface を推奨するという内容の記事になっています。\nこれは d.ts を書く場合に覚えておくとよさそうです。</p>\n<p>TypeScript の Type か interface を使うか、型推論に任せるかは時と場合によるというのを前提での紹介でした！</p>\n<hr>\n<h3><a href=\"https://zenn.dev/kalan/articles/6e96e13fb2b0447af4f6\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Vue Refの糖衣構文と Svelte</a></h3>\n<ul>\n<li>共有者: nakajmg</li>\n</ul>\n<p>vueのrfcに<a href=\"https://composition-api.vuejs.org/api.html#ref\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">ref</code></a>の糖衣構文である<a href=\"https://github.com/vuejs/rfcs/blob/script-setup/active-rfcs/0000-script-setup.md#2-ref-sugar-makes-ref-usage-more-succinct\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">(Svelte inspiredな)<code class=\"language-text\">ref:</code>構文についてのrfc</a>が出されました。この記事ではメリデメやSvelteとの比較などについて書かれています。</p>\n<h4>rfcの背景</h4>\n<p>vueではリアクティブな変数を定義するために<code class=\"language-text\">ref()</code>という関数を使います。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createComponent<span class=\"token punctuation\">,</span> ref <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'vue'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token function\">createComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> count <span class=\"token operator\">=</span> <span class=\"token function\">ref</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">function</span> <span class=\"token function\">inc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      count<span class=\"token punctuation\">.</span>value<span class=\"token operator\">++</span>\n    <span class=\"token punctuation\">}</span>\n\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>count<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      count<span class=\"token punctuation\">,</span>\n      inc\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">ref()</code>で作成した変数の取得/更新は<code class=\"language-text\">count.value</code>のように<code class=\"language-text\">.value</code>を経由する必要があります。TypeScriptを採用していれば<code class=\"language-text\">.value</code>を経由しないで参照しようとするとエラーなりが出るので問題ないですが、そうでない場合は<code class=\"language-text\">ref()</code>で作られた変数と通常の(reactiveじゃない）変数を区別する必要があります。</p>\n<h4>提案された構文</h4>\n<p>この<code class=\"language-text\">.value</code>を使うのが面倒で冗長だよねというところから次のような糖衣構文が提案されています。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">&lt;</span>script setup<span class=\"token operator\">></span>\n<span class=\"token comment\">// declaring a variable that compiles to a ref</span>\nref<span class=\"token operator\">:</span> count <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">inc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// the variable can be used like a plain value</span>\n  count<span class=\"token operator\">++</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// access the raw ref object by prefixing with $</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>$count<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span></code></pre></div>\n<blockquote>\n<p><a href=\"https://github.com/vuejs/rfcs/blob/script-setup/active-rfcs/0000-script-setup.md#2-ref-sugar-makes-ref-usage-more-succinct\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/vuejs/rfcs/blob/script-setup/active-rfcs/0000-script-setup.md#2-ref-sugar-makes-ref-usage-more-succinct</a></p>\n</blockquote>\n<p><a href=\"https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Statements/label\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ラベル付き文</a>の構文を使ってreactiveな変数を定義し、<code class=\"language-text\">.value</code>なしに参照しています。</p>\n<p>このコードはコンパイルされて👆にあるようなコードに変換されます。</p>\n<h4>JavaScriptのセマンティクスとトレードオフ</h4>\n<p><code class=\"language-text\">.value</code>を経由するようになっているのはJavaScriptの言語的な制約からきているもので、vueはJavaScriptのセマンティクスを変更/拡張することなくリアクティブを実現するためにこうしています。\n今回のrfcは、JavaScriptのセマンティクスから逸れてると認識しながらも、開発者の体験を向上させるためにトレードオフを行う余地があるのではという考えから提出されました。</p>\n<h4>感想</h4>\n<p>自分は次の理由からあまりいい提案ではないように思います。</p>\n<ul>\n<li>\n<p>vue独自の構文である</p>\n<ul>\n<li>どんどん増えていきそう</li>\n<li>JavaScriptエコシステムへの負荷(Linterとかエディタ）</li>\n</ul>\n</li>\n<li>本来のラベル付き文から逸脱している</li>\n<li>コンパイル前後のコードに差異が結構ある</li>\n</ul>\n<p>この糖衣構文によって開発者の体験が短期的には向上するかもしれませんが、解決したい課題に対してデメリットが上回っていると感じています。（このrfcに限らずvueが<code class=\"language-text\">&lt;script setup&gt;</code>など、独自の糖衣構文的なものを追加してくる傾向があること自体にあまりいい印象を持っていないです。）</p>\n<hr>\n<h3><a href=\"https://blog.isquaredsoftware.com/series/how-web-apps-work/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">How Web Apps Work | Mark's Dev Blog</a></h3>\n<ul>\n<li>共有者:toshi-toma</li>\n</ul>\n<p>Reduxのメンテーである<a href=\"https://twitter.com/acemarke\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Mark Erikson</a>による、Web開発の概念や用語、ツール、技術について説明するシリーズ。Web開発は様々な技術が出てくるので、それらがなぜ必要なのか、どう関係してるのかを説明してる。そして、必要に応じて深く調べれるように別記事への導線も用意されている。</p>\n<p>個人的に、Reduxのドキュメントの英語読みやすいなーと思ってたので、網羅的に書かれていて、かつ読みやすい記事でありがたいなと思いました。</p>\n<p>テーマごとに全5記事ある</p>\n<ul>\n<li>\n<p><a href=\"https://blog.isquaredsoftware.com/2020/11/how-web-apps-work-http-server/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">HTTP and Servers</a></p>\n<ul>\n<li>HTTPとアプリケーションサーバーの話</li>\n<li>触れてる内容: HTTP, IPアドレス, DNS, HTTPリクエスト, HTTPレスポンス, ヘッダー, HTTPメソッド, ステータスコード, クッキー, アプリケーションサーバー(リクエストの処理、ルーティング、静的ファイル、動的なWebアプリケーションサーバー)</li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://blog.isquaredsoftware.com/2020/11/how-web-apps-work-client-dev-deployment/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Client Development and Deployment</a></p>\n<ul>\n<li>JSメインのフロントエンド開発の話</li>\n<li>触れてる内容: JSの歴史, JSモジュールフォーマット, コンパイル(トランスパイル), バンドル, 開発環境ツール(Node.js), デプロイ, ポリフィル, Code Splitting</li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://blog.isquaredsoftware.com/2020/11/how-web-apps-work-html-css/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Browsers, HTML, and CSS</a></p>\n<ul>\n<li>ブラウザとHTML, CSSの話</li>\n<li>触れてる内容: ブラウザ, メジャーブラウザ, HTML, タグや属性, セマンティクス, CSS, 構文とセレクタ, ページレイアウト(ボックスモデル, display, position, flexbox, grid), レスポンシブ</li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://blog.isquaredsoftware.com/2020/11/how-web-apps-work-javascript-dom/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">JavaScript and the DOM</a></p>\n<ul>\n<li>JSの幅広い基本的な内容とDOMの話</li>\n<li>触れてる内容: ECMAScript, JSの概要(構文, データタイプ, 組み込み関数, this, Class, タイマーとイベントループ, 非同期処理), イミュータブル, DOM, jQuery</li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://blog.isquaredsoftware.com/2020/11/how-web-apps-work-ajax-apis-data/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">AJAX, APIs, and Data Transfer</a></p>\n<ul>\n<li>クライアントとサーバー間でデータをやり取りする話</li>\n<li>触れてる内容: JSON, Ajax, ポーリング, WebSockets, CORS, REST, RPC, GraphQL, ブラウザストレージ, クライアントルーティング</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h3><a href=\"https://github.com/tc39/proposal-js-module-blocks\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">tc39/proposal-js-module-blocks</a></h3>\n<ul>\n<li>共有者: @sosukesuzuki</li>\n</ul>\n<p>JS Modules Blocks は先日の TC39 ミーティングで <a href=\"https://twitter.com/DasSurma/status/1329059832150831111\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Stage 1 になった</a> プロポーザルです。</p>\n<p>このプロポーザルは、ファイルを隔てずにモジュールを定義できるインラインモジュール式(<code class=\"language-text\">InlineModuleExpression</code>)という新しい構文を導入します。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> m <span class=\"token operator\">=</span> module <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> foo <span class=\"token operator\">=</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>この <code class=\"language-text\">module {}</code> という部分が新しく導入される構文です。式なので、結果をそのまま値として扱うことが可能です。</p>\n<p>ここで定義された<code class=\"language-text\">m</code>は <code class=\"language-text\">import(...)</code> で import できます。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> m <span class=\"token operator\">=</span> module <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> foo <span class=\"token operator\">=</span> <span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">const</span> m1 <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>m1<span class=\"token punctuation\">.</span>foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// hello</span></code></pre></div>\n<p>まだ Stage 1 なのでこれから仕様が大幅に変更される可能性はありますが、実用性もあり面白い提案なので、注目しておくと良さそうです。</p>\n<hr>\n<h3><a href=\"https://techracho.bpsinc.jp/hachi8833/2020_11_02/97774\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">WebAssemblyハンズオン: 実際に動かして基礎を学ぶ（翻訳）</a></h3>\n<ul>\n<li>共有者: @zaki___yama</li>\n</ul>\n<p>原文は8月頃に投稿された <a href=\"https://evilmartians.com/chronicles/hands-on-webassembly-try-the-basics\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Hands-on WebAssembly: Try the basics — Martian Chronicles, Evil Martians’ team blog</a> という記事。</p>\n<p>ハンズオンと書いてますが手を動かす成分は少なめ。環境構築もDockerで提供されてるものを使うので楽です。（何をインストールしてるのかわかりづらいというのはある）</p>\n<p>内容としては</p>\n<ul>\n<li><code class=\"language-text\">clang</code> を使った素朴なやり方でCのソースをwasmにコンパイルする</li>\n<li><code class=\"language-text\">wasm-objdump</code> でwasmの中身を確認する</li>\n<li>Bynarien (<code class=\"language-text\">wasm-opt</code>) でwasmのバイナリサイズを圧縮する</li>\n<li>WebAssembly Binary toolkit (wabt) でwasmをwatに変換し、中身を確認する</li>\n<li>Emscripten でコンパイルしてみる</li>\n<li>同じことを Rust でやってみる（ライブラリを使ったやり方）</li>\n</ul>\n<p>という感じで、CメインでRustはおまけ程度。</p>\n<p>大部分はCでwasm書く予定がなければ必要ない情報かなーと思いましたが、個人的には</p>\n<ul>\n<li>「コンパイラの即席入門(Compilers 101)」で説明されてるコンパイラの概要\n（コンパイラはソースコードをパースして一旦内部表現(IR)に変換する。WebAssemblyはどんなブラウザでも理解できる内部表現という位置づけ）</li>\n<li>\n<p>「ドラゴンのはらわた（Dragon guts）」</p>\n<ul>\n<li>テキスト形式の <code class=\"language-text\">.wat</code> ファイルの読み方</li>\n</ul>\n</li>\n</ul>\n<p>あたりが面白かったです。</p>\n<p>元のCの関数</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">int</span> <span class=\"token function\">sign</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> x<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">%</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span> <span class=\"token operator\">-</span> <span class=\"token punctuation\">(</span>x <span class=\"token operator\">%</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p>を wat にすると、</p>\n<div class=\"gatsby-highlight\" data-language=\"wat\"><pre class=\"language-wat\"><code class=\"language-wat\">(func (;1;) (type 0) (param i32) (result i32)\n  i32.const 2\n  local.get 0\n  i32.const 4\n  i32.rem_s\n  i32.sub\n  local.get 0\n  i32.const 2\n  i32.rem_s\n  i32.mul)</code></pre></div>\n<p>となり、これは</p>\n<ol>\n<li>整数値 <code class=\"language-text\">2</code> をスタックにpushする（<code class=\"language-text\">i32.const 2</code>）</li>\n<li>関数の最初のパラメーターをスタックにpush（<code class=\"language-text\">local.get 0</code>）</li>\n<li>整数値 <code class=\"language-text\">4</code> をスタックにpush（<code class=\"language-text\">i32.const 4</code>）</li>\n<li>スタックから2つの値を削除して1番目の値を2番目の値で割った余りをスタックにpushする（<code class=\"language-text\">i32.rem_s</code>）</li>\n</ol>\n<p>が <code class=\"language-text\">x % 4</code> に相当します。</p>\n<hr>\n<h3><a href=\"https://blog.carlmjohnson.net/post/2020/time-to-kill-ie11/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Dropping Support For IE11 Is Progressive Enhancement · The Ethically-Trained Programmer</a></h3>\n<ul>\n<li>共有者: @pirosikick </li>\n</ul>\n<p>IE11をサポートする労力をJavaScriptを無効にしているユーザーのために使ったほうがいいんじゃないかという話。</p>\n<ul>\n<li>\n<p>IE11は減少傾向だが、JS無し環境は無くならない</p>\n<ul>\n<li>JSをダウンロードしている間はみんなJS無し環境</li>\n<li>広告ブロッカーの普及によって、JS無し・JSが壊れている人は一定数居る</li>\n</ul>\n</li>\n<li>\n<p>QAチームがない場合、問い合わせが無いだけでIE11で壊れているかも</p>\n<ul>\n<li>Babel/Autoprefixerなどによるトラスパイルだけでは不完全で、APIのpolyfill、IE11特有のバグへの対応など、IE11対応するならIE11でQAする必要がある</li>\n</ul>\n</li>\n<li>\n<p>IE11サポートする代わりに、scriptタグのmodule/nomoduleを使ってProgressive Enhancementしよう</p>\n<ul>\n<li>nomodule側はできる限るJSを少なくするべき。</li>\n<li>理想は全く無しだが、実際は広告やAnaliticsだけJS使うことになりそう</li>\n<li>AnaliticsにIE11ユーザーが出続ける限り、ちゃんと動いているはず</li>\n</ul>\n</li>\n<li>\n<p>JS無しユーザーのために特別な実装するほうが大変じゃない？</p>\n<ul>\n<li>基本は、JS無しユーザー用のクラス(<code class=\"language-text\">.has-old-js</code>)を使って、要素の表示・非表示するだけ</li>\n<li>最近のJSは十分にモジュール化されているはず</li>\n</ul>\n</li>\n<li>\n<p>筆者の具体例</p>\n<ul>\n<li>モーダルがIE11では出ない、静的なレイアウトへの切り替え、検索機能はGoogleに送信するフォームへ切り替え</li>\n</ul>\n</li>\n</ul>\n<p>※余談：ブログが「The Ethically-Trained Programmer（倫理的に訓練されたプログラマ）」でfaviconが「倫」で笑った</p>\n<hr>\n<h3><a href=\"https://epicreact.dev/css-variables/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Use CSS Variables instead of React Context | Epic React by Kent C. Dodds</a></h3>\n<ul>\n<li>共有者: @pirosikick </li>\n</ul>\n<p>CSS in JSのReact Contextを使ったテーマ機能（例：<a href=\"https://styled-components.com/docs/advanced#theming\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">styled-componentsのThemeProvider</a>）より、CSS Variablesを使おうという話。</p>\n<ul>\n<li>開発者体験的には違いはない（個人的にはCSS Variablesのほうがシンプルで好き）</li>\n<li>テーマ切替時に再描画するコンポーネント数がReact Contextのほうが多い</li>\n</ul>\n<hr>\n<h3><a href=\"https://ja.nsommer.dk/articles/type-checked-url-router.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Building a type checked url router from scratch</a></h3>\n<ul>\n<li>共有者: @shisama_</li>\n</ul>\n<p>SPAのルーティングに設定するURLの型を TypeScript 4.1 で新しく追加された Template Literal Types を使って検査する方法の紹介です。</p>\n<p>Template Literal Types については<a href=\"https://devblogs.microsoft.com/typescript/announcing-typescript-4-1/#template-literal-types\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Announcing TypeScript 4.1</a>の記事で紹介されています。</p>\n<p>記事中の型宣言から一部抜き出すと次のように Template Literal で文字列からinfer で値を抜き出すことが出来ます。</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">TemplateVariables<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span></span> <span class=\"token operator\">=</span> <span class=\"token constant\">T</span> <span class=\"token keyword\">extends</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>infer Start<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>infer Variable<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n    <span class=\"token operator\">?</span> TemplateVariables<span class=\"token operator\">&lt;</span>Start<span class=\"token operator\">></span> <span class=\"token operator\">|</span> Variable\n    <span class=\"token operator\">:</span> <span class=\"token builtin\">never</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">param</span> <span class=\"token operator\">=</span> TemplateVariables<span class=\"token operator\">&lt;</span><span class=\"token string\">\"/api/users/:id\"</span><span class=\"token operator\">></span>\n<span class=\"token comment\">// param = \"id\"</span></code></pre></div>\n<p>この記事の最終的な目的はコンポーネントに紐付けたパスのパラメータとコンポーネントのPropsの型が同じになるようにしたいということです。</p>\n<p>記事中から一部抜粋した例をあげます。\n以下のようなコンポーネントがあったとき、</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">type MyDogProps <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  name<span class=\"token operator\">:</span> string\n  breed<span class=\"token operator\">:</span> string\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> MyDog <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> name<span class=\"token punctuation\">,</span> breed <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> MyDogProps<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token parameter\">string</span> <span class=\"token operator\">=></span>\n  <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;p>My dog's name is </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> and it's a </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>breed<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/p>\n   &lt;p></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">Link</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> route<span class=\"token operator\">:</span> routes<span class=\"token punctuation\">.</span>home<span class=\"token punctuation\">,</span> children<span class=\"token operator\">:</span> <span class=\"token string\">\"Back to home\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/p></span><span class=\"token template-punctuation string\">`</span></span></code></pre></div>\n<p>以下のようなルーティング定義をしておきます。</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> routes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  home<span class=\"token operator\">:</span>   <span class=\"token function\">route</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>Home<span class=\"token punctuation\">,</span>   <span class=\"token string\">'/'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  dog<span class=\"token operator\">:</span>    <span class=\"token function\">route</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>MyDog<span class=\"token punctuation\">,</span>  <span class=\"token string\">'my-dog/:name/:breed'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  search<span class=\"token operator\">:</span> <span class=\"token function\">route</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>Search<span class=\"token punctuation\">,</span> <span class=\"token string\">'search/:query'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>注目してほしいのが、<code class=\"language-text\">my-dog/:name/:breed</code>の<code class=\"language-text\">name</code>と<code class=\"language-text\">breed</code>です。これえはMyDogPropsのキーと同じです。なので、たとえば以下のようにMyDogPropsのキー名が違う場合エラーになります。</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">MyDogProps</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  name<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n  breed_name<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> routes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  dog<span class=\"token operator\">:</span>    <span class=\"token function\">route</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>MyDog<span class=\"token punctuation\">,</span>  <span class=\"token string\">'my-dog/:name/:breed'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// breed というプロパティはないためエラー</span></code></pre></div>\n<p>また、Props には定義されているのにパスには存在しない場合もエラーになります。</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">MyDogProps</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  name<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n  breed<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n  age<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> routes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  dog<span class=\"token operator\">:</span>    <span class=\"token function\">route</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>MyDog<span class=\"token punctuation\">,</span>  <span class=\"token string\">'my-dog/:name/:breed'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// age がないためエラー</span></code></pre></div>\n<p>逆にPropsにないパラメータをパスに含めてもエラーになります。</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">MyDogProps</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  name<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n  breed<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> routes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  dog<span class=\"token operator\">:</span>    <span class=\"token function\">route</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>MyDog<span class=\"token punctuation\">,</span>  <span class=\"token string\">'my-dog/:name/:breed/:age'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// Propsにageはないためエラー</span></code></pre></div>\n<p>このようにコンポーネントが期待するパラメータが正しく渡ってくることを事前にチェックすることができます。</p>\n<hr>","frontmatter":{"title":"Cybozu Frontend Monthly","date":"2020-11-24T17:00:00+09:00","no":5,"connpass":null,"streamUrl":null,"hashTag":"#サイボウズフロントエンドマンスリー","members":[{"name":"@koba04","link":"https://twitter.com/koba04"},{"name":"@pirosikick","link":"https://twitter.com/pirosikick"},{"name":"@toshi__toma","link":"https://twitter.com/toshi__toma"},{"name":"@zaki___yama","link":"https://twitter.com/zaki___yama"},{"name":"@__sakito__","link":"https://twitter.com/__sakito__"},{"name":"@shisama_","link":"https://twitter.com/shisama_"},{"name":"@nakajmg","link":"https://twitter.com/nakajmg"},{"name":"@b4h0_c4t","link":"https://twitter.com/b4h0_c4t"},{"name":"@__sosukesuzuki","link":"https://twitter.com/__sosukesuzuki"}],"guest":null}}},"pageContext":{"id":"3cbdadbf-7c1f-568a-8a33-d34febfad8f2"}},"staticQueryHashes":["764694655"]}