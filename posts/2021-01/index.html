<!DOCTYPE html><html><head><title>Cybozu Frontend Monthly #7</title><meta name="description" content="サイボウズのフロントエンドエキスパートチームが月イチでお届けするフロントエンド情報"/><meta name="og:description" content="サイボウズのフロントエンドエキスパートチームが月イチでお届けするフロントエンド情報"/><meta name="og:title" content="Cybozu Frontend Monthly #7"/><meta name="og:type" content="website"/><meta name="og:image" content="https://cybozu.github.io/frontend-monthly/assets/img/header.png"/><meta name="twitter:title" content="Cybozu Frontend Monthly #7"/><meta name="twitter:description" content="サイボウズのフロントエンドエキスパートチームが月イチでお届けするフロントエンド情報"/><meta name="twitter:card" content="summary"/><meta name="twitter:creator" content="Cybozu Frontend Expert Team"/><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.21.0/themes/prism.min.css"/><meta name="next-head-count" content="14"/><link rel="preload" href="/frontend-monthly/_next/static/css/de019082f7bd6e5c1d8d.css" as="style"/><link rel="stylesheet" href="/frontend-monthly/_next/static/css/de019082f7bd6e5c1d8d.css" data-n-g=""/><link rel="preload" href="/frontend-monthly/_next/static/css/dfdf5f649880e41cbd5c.css" as="style"/><link rel="stylesheet" href="/frontend-monthly/_next/static/css/dfdf5f649880e41cbd5c.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/frontend-monthly/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/frontend-monthly/_next/static/chunks/webpack-377d9957422d331503bc.js" defer=""></script><script src="/frontend-monthly/_next/static/chunks/framework-92300432a1172ef1338b.js" defer=""></script><script src="/frontend-monthly/_next/static/chunks/main-7ae1bed21f7b794bd4c4.js" defer=""></script><script src="/frontend-monthly/_next/static/chunks/pages/_app-0eda503e19a294e1d1a6.js" defer=""></script><script src="/frontend-monthly/_next/static/chunks/423-4bcace61643c26d7ea4d.js" defer=""></script><script src="/frontend-monthly/_next/static/chunks/pages/posts/%5Bslug%5D-ef2fc0284b56e952f610.js" defer=""></script><script src="/frontend-monthly/_next/static/D_S-f2v3rZUXwnRGG-ZyZ/_buildManifest.js" defer=""></script><script src="/frontend-monthly/_next/static/D_S-f2v3rZUXwnRGG-ZyZ/_ssgManifest.js" defer=""></script></head><body><div id="__next"><style data-emotion="css crwfbk">.css-crwfbk{display:grid;grid-template-rows:auto 1fr auto;height:100vh;box-sizing:border-box;}.css-crwfbk .main{box-sizing:border-box;min-width:200px;max-width:980px;width:100%;margin:0 auto;padding:15px 45px;color:#24292e;}.css-crwfbk .main h1{margin-top:0;}@media (max-width: 767px){.css-crwfbk .main{padding:12px;font-size:14px;}.css-crwfbk .main .markdown-body{font-size:14px;}.css-crwfbk .main h1{font-size:1.55em;margin-bottom:0.25em;margin-top:0.5em;}.css-crwfbk .main h2{font-size:1.3em;margin-bottom:0.25em;margin-top:0.5em;}.css-crwfbk .main h3{font-size:1.1em;margin-bottom:0.25em;margin-top:0.5em;}.css-crwfbk .main hr{margin:12px 0;}}.css-crwfbk .footer{background-color:#31424e;text-align:center;color:#f8f8ff;font-size:0.75em;padding:5px 0;}.css-crwfbk .footer a{color:inherit;}</style><div class="markdown-body css-crwfbk"><main class="main"><style data-emotion="css e4jomx">.css-e4jomx .markdown-body img{border:1px solid rgba(0, 0, 0, 0.1);max-width:90%;height:auto;margin:12px auto;display:block;}.css-e4jomx .markdown-body li>p{margin:8px 0;}@media screen and (max-width: 420px){.css-e4jomx .markdown-body{font-size:14px;}.css-e4jomx .markdown-body li>p{margin:4px 0;}}.css-e4jomx h1{margin-top:0;}.css-e4jomx >h1:first-of-type{margin-top:0!important;}.css-e4jomx h3{position:relative;margin-left:-5px;padding-left:5px;}.css-e4jomx h3:hover .icon.icon-link{position:absolute;right:calc(100%);}.css-e4jomx h3:hover .icon.icon-link:before{font-size:0.75em;content:"🔗";}</style><article class="css-e4jomx"><h1>Cybozu Frontend Monthly #7</h1><div><img src="/frontend-monthly/assets/img/header.png" width="659" height="229" alt=""/></div><h2>イベント概要</h2><p><strong>サイボウズフロントエンドマンスリー</strong>は、サイボウズ社内で行っているフロントエンド情報共有会「フロントエンドウィークリー」の公開版です。</p><p>その月に気になったフロントエンドの情報を、サイボウズのフロントエンドエキスパートチームのメンバーが共有していきます。</p><p><strong>このイベントのハッシュタグは<!-- --> <a href="https://twitter.com/search?q=%23%E3%82%B5%E3%82%A4%E3%83%9C%E3%82%A6%E3%82%BA%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89%E3%83%9E%E3%83%B3%E3%82%B9%E3%83%AA%E3%83%BC" target="_blank" rel="noopener noreferrer">#サイボウズフロントエンドマンスリー</a> <!-- -->です。</strong></p><style data-emotion="css y47mw7">.css-y47mw7 h3{margin-top:0;}.css-y47mw7 p{margin-bottom:0;white-space:pre-line;}</style><pre class="css-y47mw7"><h3>※フロントエンドウィークリーとは</h3><p>毎週火曜の 17:00 〜 18:00 で社内向けに行っているフロントエンドの気になる記事を紹介する会です。2016年3月15日から行われています。<br/>ハッシュタグ<!-- --> <a href="https://twitter.com/search?q=%23%E3%82%B5%E3%82%A4%E3%83%9C%E3%82%A6%E3%82%BA%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89%E3%82%A6%E3%82%A3%E3%83%BC%E3%82%AF%E3%83%AA%E3%83%BC" target="_blank" rel="noopener noreferrer">#サイボウズフロントエンドウィークリー</a> <!-- -->で実況しています。</p></pre><h3>開催日</h3><p>2021年01月26日</p><h3>イベントページ</h3><p><a href="https://cybozu.connpass.com/event/202029/" target="_blank" rel="noopener noreferrer">https://cybozu.connpass.com/event/202029/</a></p><h3>配信URL</h3><style data-emotion="css 14br0ti">.css-14br0ti .embed{display:block;max-width:100%;max-height:280px;}</style><p class="css-14br0ti"><iframe title="https://www.youtube.com/embed/MMFzKjIzdRA" width="560" height="315" src="https://www.youtube.com/embed/MMFzKjIzdRA" frameBorder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" class="embed"></iframe><a href="https://www.youtube.com/watch?v=MMFzKjIzdRA" target="_blank" rel="noreferrer noopner">https://www.youtube.com/watch?v=MMFzKjIzdRA</a></p><h3>タイムテーブル</h3><table><tbody><tr><td>07:50 - 08:00</td><td>配信開始</td></tr><tr><td>08:00 - 08:05</td><td>オープニング</td></tr><tr><td>08:05 - 08:55</td><td>本編</td></tr><tr><td>08:55 - 09:00</td><td>クロージング</td></tr></tbody></table><h2>メンバー</h2><style data-emotion="css 1g63iqu">.css-1g63iqu{display:grid;grid-template-columns:repeat(auto-fill, minmax(120px, 1fr));grid-gap:24px 12px;padding:12px;}.css-1g63iqu .member{text-align:center;}.css-1g63iqu .thumbnail{border-radius:50%;margin:0 auto 5px;}</style><div class="css-1g63iqu"><div class="member"><img class="thumbnail" src="/frontend-monthly/assets/photo/f8079885d680213e64e4d706daa4a5ee_400x400.jpeg" width="100" height="100" alt=""/><a href="https://twitter.com/koba04" target="_blank" rel="noopener noreferrer">@koba04</a></div><div class="member"><img class="thumbnail" src="/frontend-monthly/assets/photo/a95b52be00e06cd293a6853bc36490bc_400x400.jpeg" width="100" height="100" alt=""/><a href="https://twitter.com/pirosikick" target="_blank" rel="noopener noreferrer">@pirosikick</a></div><div class="member"><img class="thumbnail" src="/frontend-monthly/assets/photo/fGX7e5wk_400x400.jpg" width="100" height="100" alt=""/><a href="https://twitter.com/toshi__toma" target="_blank" rel="noopener noreferrer">@toshi__toma</a></div><div class="member"><img class="thumbnail" src="/frontend-monthly/assets/photo/Q_ihmvTQ_400x400.png" width="100" height="100" alt=""/><a href="https://twitter.com/zaki___yama" target="_blank" rel="noopener noreferrer">@zaki___yama</a></div><div class="member"><img class="thumbnail" src="/frontend-monthly/assets/photo/erghEqaW_400x400.png" width="100" height="100" alt=""/><a href="https://twitter.com/__sakito__" target="_blank" rel="noopener noreferrer">@__sakito__</a></div><div class="member"><img class="thumbnail" src="/frontend-monthly/assets/photo/A9M8G6DH_400x400.jpg" width="100" height="100" alt=""/><a href="https://twitter.com/shisama_" target="_blank" rel="noopener noreferrer">@shisama_</a></div><div class="member"><img class="thumbnail" src="/frontend-monthly/assets/photo/EKNVNzOg_400x400.jpg" width="100" height="100" alt=""/><a href="https://twitter.com/nakajmg" target="_blank" rel="noopener noreferrer">@nakajmg</a></div><div class="member"><img class="thumbnail" src="/frontend-monthly/assets/photo/QySbTwnO_400x400.jpg" width="100" height="100" alt=""/><a href="https://twitter.com/b4h0_c4t" target="_blank" rel="noopener noreferrer">@b4h0_c4t</a></div><div class="member"><img class="thumbnail" src="/frontend-monthly/assets/photo/7iJNhdua_400x400.jpg" width="100" height="100" alt=""/><a href="https://twitter.com/__sosukesuzuki" target="_blank" rel="noopener noreferrer">@__sosukesuzuki</a></div></div><hr/><h2>紹介記事</h2><div class="markdown-body"><h3 id="javascript-アンケート周り"><a href="#javascript-%E3%82%A2%E3%83%B3%E3%82%B1%E3%83%BC%E3%83%88%E5%91%A8%E3%82%8A" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>JavaScript アンケート周り</h3>
<ul>
<li>
<p>共有者: @__sakito__</p>
</li>
<li>
<p><a href="https://2020.stateofjs.com/en-US/" target="_blank" rel="nofollow">State of JS 2020</a></p>
<ul>
<li><a href="https://2020.stateofjs.com/ja-JP/" target="_blank" rel="nofollow">日本語訳</a></li>
</ul>
</li>
<li>
<p><a href="https://risingstars.js.org/2020/en" target="_blank" rel="nofollow">2020 JavaScript Rising Stars</a></p>
<ul>
<li><a href="https://risingstars.js.org/2020/ja" target="_blank" rel="nofollow">日本語訳</a></li>
</ul>
</li>
</ul>
<p>両方とも 2020 年の流れを把握するのに使えそうです。</p>
<p>State of JS は、ビルドが esbuild や sbowpack、フレームワークは引き続き svelte に興味持ってる人が多かったです。
しかし実際に使用してるものは、webpack などになっており、新しいものはまだプロダクションで使用するには踏み込めない印象。
各項目で色々な人が 2020 年の個人的ベストを紹介してるのが面白かった、<a href="https://github.com/atlassian/changesets" target="_blank" rel="nofollow">changesets</a>、<a href="https://insomnia.rest/" target="_blank" rel="nofollow">Insomnia</a>、<a href="https://redwoodjs.com/" target="_blank" rel="nofollow">Redwood</a>など知らないものを知れました。</p>
<p>2020 JavaScript Rising Stars は、あくまでスター数なので State of JS 2020 と見比べて世間がどこに注目しているか照らし合わせるとよさそうです。
各セクションで説明もあるので、なぜスター数が増えたのかもわかりやすいです。</p>
<hr>
<h3 id="dont-use-inverted-color-cues-on-toggle-buttons"><a href="#dont-use-inverted-color-cues-on-toggle-buttons" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><a href="https://uxmovement.com/buttons/dont-use-inverted-color-cues-on-toggle-buttons/" target="_blank" rel="nofollow">Don’t Use Inverted Color Cues on Toggle Buttons</a></h3>
<ul>
<li>共有者: @pirosikick</li>
</ul>
<p>トグルボタンでボタンの文字色と背景色を反転させた ON・OFF ボタンを作りがちだが、
色のコントラスト比が同じになるのでどちらが ON で OFF なのかわからず誤操作が増えがちなので気をつけなはれや、という内容。
ブログの画像を見ると分かりやすいですが、色の反転の代わりに奥行きで ON/OFF を表現するといいよとのことです。
最近、tailwind.css を使っていて悪い例と同じようなことをしていたので、タイムリーで参考になりました。</p>
<hr>
<h3 id="classi-にフロントエンドエキスパートチームを作った話"><a href="#classi-%E3%81%AB%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89%E3%82%A8%E3%82%AD%E3%82%B9%E3%83%91%E3%83%BC%E3%83%88%E3%83%81%E3%83%BC%E3%83%A0%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%9F%E8%A9%B1" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><a href="https://tech.classi.jp/entry/2021/01/18/103110" target="_blank" rel="nofollow">Classi にフロントエンドエキスパートチームを作った話</a></h3>
<ul>
<li>共有者: @nakajmg</li>
</ul>
<p>Classi さんがフロントエンドエキスパートチームを作った話。
弊チームを参考にしてくれたとのことで、私達の活動が界隈に影響を与えられていると思うと嬉しいですね。</p>
<p>記事中では<a href="https://giamir.com/frontendops" target="_blank" rel="nofollow">FrontendOps</a>について触れており、フロントエンドの運用が開発者だけの関心事ではなく、チーム全員にとって重要であると説明しています。
今後ますますフロントエンドの運用は重要な関心事となっていくと思いますので、弊フロントエンドエキスパートチームとしても真摯に向き合って行きたいです。</p>
<hr>
<h3 id="front-end-performance-checklist-2021--smashing-magazine"><a href="#front-end-performance-checklist-2021--smashing-magazine" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><a href="https://www.smashingmagazine.com/2021/01/front-end-performance-2021-free-pdf-checklist/" target="_blank" rel="nofollow">Front-End Performance Checklist 2021 — Smashing Magazine</a></h3>
<ul>
<li>共有者: @shisama</li>
</ul>
<p>パフォーマンスに関するチェックリストです。<br>
77 個のチェックリストがありますが、長大なので挫折しそうな人はサマライズされている <a href="https://www.dropbox.com/s/34noajrbm324iai/performance-checklist-1.4.pdf" target="_blank" rel="nofollow">PDF 版</a> を読んでみて気になるところは記事の方を読んでみるのが良いかと思います。</p>
<p>記事の最後には<strong>Quic Wins</strong>として 1 時間で改善できる 17 個のことを記事中からピックアップされているので、まずはこれからはじめるのも良さそうです。<br>
個人的には「パフォーマンスの文化を作る」が最初に来ているところがいいと思いました。</p>
<p>パフォーマンスに関連する話で今月知ったものもあわせて紹介しておきます。</p>
<p>この記事の中でも CoreWebVitals を使って計測する話があり、DevTools で計測したり、<a href="https://chrome.google.com/webstore/detail/web-vitals/ahfhijdlegdabablpippeagghigmibma?hl=en" target="_blank" rel="nofollow">Chrome 拡張</a>を使っている人が多いと思いますが、Chrome 90 からは Experimental ですが Chrome 本体でもメトリクスを常に監視できるようになるようです。<br>
<a href="https://addyosmani.com/blog/performance-hud/" target="_blank" rel="nofollow">AddyOsmani.com - A Performance Heads-Up Display (HUD) for Chrome</a></p>
<p>JS のサイズについては、モダンブラウザで使える JS の構文を使うことでバンドルサイズを減らせると紹介されています。<br>
JS のネイティブに置き換えることでどれくらいバンドルサイズを減らせるかをチェックするツールがあるので、試してみるといいかもしれません。<br>
<a href="https://estimator.dev/" target="_blank" rel="nofollow">EStimator.dev: the modern JavaScript savings calculator</a></p>
<hr>
<h3 id="agenda-for-the-80th-meeting-of-ecma-tc39"><a href="#agenda-for-the-80th-meeting-of-ecma-tc39" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><a href="https://github.com/tc39/agendas/blob/master/2021/01.md" target="_blank" rel="nofollow">Agenda for the 80th meeting of Ecma TC39</a></h3>
<p>TC39 の１月のミーティングのアジェンダです。25 日~28 日にかけて行われます。</p>
<p>このミーティングでは多くのプロポーザルについての議論が行われる予定です。</p>
<h4 id="intl-系ecma402のプロポーザル"><a href="#intl-%E7%B3%BBecma402%E3%81%AE%E3%83%97%E3%83%AD%E3%83%9D%E3%83%BC%E3%82%B6%E3%83%AB" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><a href="https://github.com/tc39/ecma402" target="_blank" rel="nofollow">Intl 系(ECMA402)</a>のプロポーザル</h4>
<ul>
<li><a href="https://github.com/tc39/proposal-intl-DateTimeFormat-formatRange" target="_blank" rel="nofollow">Intl.DateTimeFormat.prototype.formatRange</a> for Stage 4</li>
<li><a href="https://github.com/tc39/proposal-intl-locale-info" target="_blank" rel="nofollow">Intl Locale Info</a> for stage 2</li>
<li><a href="https://github.com/tc39/intl-displaynames-v2" target="_blank" rel="nofollow">Intl DisplayNames</a> v2 for stage 2</li>
<li><a href="https://github.com/Louis-Aime/proposal-intl-eradisplay" target="_blank" rel="nofollow">eraDisplay option for Intl.DateTimeFormat</a> for stage 1</li>
<li><a href="https://github.com/longlho/proposal-intl-localematcher" target="_blank" rel="nofollow">Intl LocaleMatcher</a> for Stage 1</li>
<li><a href="https://github.com/FrankYFTang/proposal-intl-extend-timezonename/" target="_blank" rel="nofollow">Extend TimeZoneName Option Proposal</a> for stage 1</li>
</ul>
<h4 id="新しい構文を追加するプロポーザル"><a href="#%E6%96%B0%E3%81%97%E3%81%84%E6%A7%8B%E6%96%87%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B%E3%83%97%E3%83%AD%E3%83%9D%E3%83%BC%E3%82%B6%E3%83%AB" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>新しい構文を追加するプロポーザル</h4>
<ul>
<li>⭐<a href="https://github.com/tc39/proposal-class-static-block" target="_blank" rel="nofollow">Class static Initialization Blocks</a> for Stage 3</li>
<li>⭐<a href="https://github.com/tc39/proposal-js-module-blocks" target="_blank" rel="nofollow">JS Module Blocks</a> for stage 2</li>
<li>⭐<a href="https://github.com/bakkot/do-expressions-v2" target="_blank" rel="nofollow">do expressions</a> for stage 2</li>
<li><a href="https://github.com/bakkot/proposal-async-do-expressions" target="_blank" rel="nofollow">async do expressions</a> for stage 1</li>
<li><a href="https://github.com/mathiasbynens/proposal-regexp-set-notation" target="_blank" rel="nofollow">Adopting Unicode behavior for set notation in regular expressions</a></li>
<li><a href="https://github.com/codehag/proposal-lazy-import" target="_blank" rel="nofollow">defer module import eval</a> for stage 1</li>
</ul>
<h4 id="新しい-api-を追加するプロポーザル"><a href="#%E6%96%B0%E3%81%97%E3%81%84-api-%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B%E3%83%97%E3%83%AD%E3%83%9D%E3%83%BC%E3%82%B6%E3%83%AB" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>新しい API を追加するプロポーザル</h4>
<ul>
<li>⭐<a href="https://github.com/tc39/proposal-relative-indexing-method" target="_blank" rel="nofollow">Relative indexing method</a> for stage 4</li>
<li><a href="https://github.com/tc39/proposal-array-is-template-object" target="_blank" rel="nofollow">Array.isTemplateObject</a> for stage 3</li>
<li><a href="https://github.com/tc39/proposal-temporal" target="_blank" rel="nofollow">Temporal</a> updates</li>
<li><a href="https://github.com/tc39/proposal-resizablearraybuffer" target="_blank" rel="nofollow">ResizableArrayBuffer and GrowableSharedArrayBuffer</a> updates</li>
<li><a href="https://github.com/tc39/proposal-realms" target="_blank" rel="nofollow">Realms</a> update</li>
<li><a href="https://github.com/Kingwl/proposal-array-find-from-last" target="_blank" rel="nofollow">Array find from last</a> for stage 1</li>
</ul>
<h4 id="その他"><a href="#%E3%81%9D%E3%81%AE%E4%BB%96" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>その他</h4>
<ul>
<li><a href="https://github.com/tc39/proposal-private-fields-in-in" target="_blank" rel="nofollow">Ergonomic brand checks for private fields</a> for stage 3</li>
<li><a href="https://github.com/tc39/proposal-dynamic-code-brand-checks" target="_blank" rel="nofollow">Dynamic code brand checks</a> for stage 2</li>
<li><a href="https://github.com/hax/proposal-class-brand-check" target="_blank" rel="nofollow">class brand check</a> for stage 1</li>
<li>⭐<a href="https://github.com/tc39/proposal-json-modules" target="_blank" rel="nofollow">JSON modules</a> for stage 3</li>
<li><a href="https://github.com/tc39/proposal-regexp-match-indices" target="_blank" rel="nofollow">RegExp Match Indices</a> update</li>
</ul>
<p>数が多くて全部は紹介しきれないので、僕が個人的に気になったもの、多くの JavaScript 開発者にとって影響が大きそうなもの、かつステージが進みそうなものを紹介していきます。</p>
<details>
  <div>
<h4 id="class-static-initilization-blocks-for-stage-3"><a href="#class-static-initilization-blocks-for-stage-3" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Class static initilization Blocks for Stage 3</h4>
<p><a href="https://github.com/tc39/proposal-class-static-block" target="_blank" rel="nofollow">https://github.com/tc39/proposal-class-static-block</a></p>
<p>これは、クラスのスタティックプロパティの初期化を行うことができるブロックの構文を導入するプロポーザルです。</p>
<p>今のクラスの仕様だと、何かしらの外部の計算に依存してスタティックプロパティを決定したいとき、クラスの中だけでは不可能でした。</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> x <span class="token operator">=</span> <span class="token spread operator">...</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">.</span><span class="token property-access">x</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token constant">C</span><span class="token punctuation">.</span><span class="token property-access">y</span> <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token property-access">y</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">{</span>
  <span class="token comment">// doSomething が失敗したときのフォールバック</span>
  <span class="token constant">C</span><span class="token punctuation">.</span><span class="token property-access">y</span> <span class="token operator">=</span> <span class="token spread operator">...</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>このプロポーザルで追加するクラススタティックブロックを使うと、このような処理をクラス内のブロックに書くことができます。</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> x <span class="token operator">=</span> <span class="token spread operator">...</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> y<span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">x</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">y</span> <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token property-access">y</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">y</span> <span class="token operator">=</span> <span class="token spread operator">...</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h4 id="js-module-blocks-for-stage-2"><a href="#js-module-blocks-for-stage-2" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>JS Module Blocks for Stage 2</h4>
<p><a href="https://github.com/tc39/proposal-js-module-blocks" target="_blank" rel="nofollow">https://github.com/tc39/proposal-js-module-blocks</a></p>
<p>ちょっと前のマンスリーでも紹介しました。</p>
<p>インラインでモジュールを定義できる新しい式の構文を導入するプロポーザル。</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> moduleBlock <span class="token operator">=</span> module <span class="token punctuation">{</span>
  <span class="token keyword module">export</span> <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> moduleExports <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token keyword module">import</span><span class="token punctuation">(</span>moduleBlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assert</span><span class="token punctuation">(</span>moduleExports<span class="token punctuation">.</span><span class="token property-access">y</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>module 式で作ったモジュールは、Worker コンストラクタにそのまま渡すことができます。</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> workerCode <span class="token operator">=</span> module <span class="token punctuation">{</span>
  <span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>data<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> mod <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token keyword module">import</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">postMessage</span><span class="token punctuation">(</span>mod<span class="token punctuation">.</span><span class="token method function property-access">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span>workerCode<span class="token punctuation">,</span> <span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
worker<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>data<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">alert</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
worker<span class="token punctuation">.</span><span class="token method function property-access">postMessage</span><span class="token punctuation">(</span>module <span class="token punctuation">{</span> <span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword control-flow">return</span> <span class="token string">"hello!"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>著者のツイートからすでにステージ 2 にあがっているようです。</p>
<h4 id="do-expression-for-stage-2"><a href="#do-expression-for-stage-2" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><code>do</code> expression for Stage 2</h4>
<p><a href="https://github.com/bakkot/do-expressions-v2" target="_blank" rel="nofollow">https://github.com/bakkot/do-expressions-v2</a></p>
<p>長らく Stage 1 のままだった <code>do</code> expression です。</p>
<p>ブロックの中で最後の評価されたものが式の結果になります。また、変数のスコープは <code>do</code> のブロックの中で閉じます。</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token keyword control-flow">do</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> tmp <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  tmp <span class="token operator">*</span> tmp <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div>
<p>読みにくいネストした三項演算子の代わりに <code>if else</code> で書けるようになります。</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token keyword control-flow">do</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div>
<p>特に、JSX などの中に書くと便利です。</p>
<div class="remark-highlight"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>nav</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">Home</span></span> <span class="token punctuation">/></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token punctuation">{</span><span class="token keyword control-flow">do</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>loggedIn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">LogoutButton</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">LoginButton</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>nav</span><span class="token punctuation">></span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h4 id="relative-indexing-method"><a href="#relative-indexing-method" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Relative indexing method</h4>
<p><a href="https://github.com/tc39/proposal-relative-indexing-method" target="_blank" rel="nofollow">https://github.com/tc39/proposal-relative-indexing-method</a></p>
<p><code>Array.prototype.at</code> のことです。</p>
<p>配列の後ろから要素を取得するのが楽になります。</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token string">"d"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
arr<span class="token punctuation">.</span><span class="token method function property-access">at</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "a"</span>
arr<span class="token punctuation">.</span><span class="token method function property-access">at</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "b"</span>
arr<span class="token punctuation">.</span><span class="token method function property-access">at</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "d"</span>
</code></pre></div>
<h4 id="json-modules-for-stage-3"><a href="#json-modules-for-stage-3" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>JSON modules for Stage 3</h4>
<p><a href="https://github.com/tc39/proposal-json-modules" target="_blank" rel="nofollow">https://github.com/tc39/proposal-json-modules</a></p>
<p>JSON を JavaScript からモジュールとして読み込むときの挙動についての仕様です。</p>
<p>もともとは、<a href="https://github.com/tc39/proposal-import-assertions/" target="_blank" rel="nofollow">Import Assertions</a>の一部でしたが別の仕様として切り出されました。</p>
<p>ブラウザ上では JSON modules を使う場合は、セキュリティ上の都合から Import Assertions の構文を使って import する必要があります。</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports">json</span> <span class="token keyword module">from</span> <span class="token string">"./foo.json"</span> assert <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"json"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token string">"foo.json"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> assert<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">"json"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>ただ、これはブラウザ特有のセキュリティの問題なので、JSON modules を import するときにアサートを必須にするかどうかは各ランタイムに委ねられています(Import Assertions の構文を解釈できる必要はある)。</p>
<p>次のような JSON を考えます。</p>
<div class="remark-highlight"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"foo"</span><span class="token operator">:</span> <span class="token string">"ふー"</span><span class="token punctuation">,</span>
  <span class="token property">"bar"</span><span class="token operator">:</span> <span class="token string">"ばー"</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>これを JavaScript から import するときは default export として解釈します。</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token keyword module">import</span> <span class="token imports">json</span> <span class="token keyword module">from</span> <span class="token string">"./foobar.json"</span><span class="token punctuation">;</span>

<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span><span class="token property-access">foo</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ふー</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span><span class="token property-access">bar</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ばー</span>
</code></pre></div>
<p>JSON のキーには JavaScript の識別子として妥当でないものを使用できるため、named export はサポートされていません。</p>
<div class="remark-highlight"><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"32"</span><span class="token operator">:</span> <span class="token string">"さんじゅうに"</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div class="remark-highlight"><pre class="language-js"><code class="language-js"><span class="token comment">// 数字は識別子として認められていない</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> <span class="token number">32</span> <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"numbers.json"</span><span class="token punctuation">;</span>
</code></pre></div>
  </div>
</details>
<hr>
<h3 id="enabling-popups---microsoftedgemsedgeexplainers"><a href="#enabling-popups---microsoftedgemsedgeexplainers" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><a href="https://github.com/MicrosoftEdge/MSEdgeExplainers/blob/main/Popup/explainer.md" target="_blank" rel="nofollow">Enabling Popups - MicrosoftEdge/MSEdgeExplainers</a></h3>
<ul>
<li>共有者: @zaki___yama</li>
</ul>
<p><a href="https://cybozu.github.io/frontend-monthly/posts/2020-08" target="_blank" rel="nofollow">以前の Frontend Monthly</a>で "<a href="https://github.com/MicrosoftEdge/MSEdgeExplainers/blob/main/ControlUICustomization/explainer.md" target="_blank" rel="nofollow">Enabling Custom Control UI</a>" というプロポーザルを紹介したんですが、その続編みたいなプロポーザルです。
といってもその後の動向を熱心にウォッチしてたわけではなく、例によって Edge の PM の<a href="https://twitter.com/soMelanieSaid/status/1352324867941568512?s=20" target="_blank" rel="nofollow">ツイート</a> から知りました。</p>
<h4 id="概要"><a href="#%E6%A6%82%E8%A6%81" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>概要</h4>
<ul>
<li><code>&#x3C;popup></code> という新しい HTML 要素の提案です</li>
<li>他の HTML 要素と同じようにマークアップを書き、 <code>show()/hide()</code> メソッドで表示／非表示を制御します</li>
</ul>
<div class="remark-highlight"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>button</span> <span class="token attr-name">aria-haspopup</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">aria-controls</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>menuPopup<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>menuButton<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  Menu
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>button</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>popup</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>menuPopup<span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>menu<span class="token punctuation">"</span></span> <span class="token attr-name">anchor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>menuButton<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token comment">&#x3C;!-- Markup for menuitems goes here --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>popup</span><span class="token punctuation">></span></span>
</code></pre></div>
<div class="remark-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">"menuButton"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">"menuPopup"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<ul>
<li><code>popup</code> は独立した要素の可能性もあるし、combobox のようなより大きな複合的な(composited)コンポーネントの一部の可能性もあります</li>
</ul>
<h4 id="面白いと思ったポイントいくつか"><a href="#%E9%9D%A2%E7%99%BD%E3%81%84%E3%81%A8%E6%80%9D%E3%81%A3%E3%81%9F%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%81%84%E3%81%8F%E3%81%A4%E3%81%8B" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>面白いと思ったポイントいくつか</h4>
<ul>
<li>popup は以下の挙動をする。これらの挙動をプロポーザル中では "light dismiss" と表現している
<ul>
<li>ユーザーが Escape キーを押した</li>
<li><code>popup</code> またはそのアンカー要素の layout が変更された</li>
<li>フォーカスが外れた</li>
</ul>
</li>
<li>[<a href="https://github.com/MicrosoftEdge/MSEdgeExplainers/blob/main/Popup/explainer.md#anchored-positioning" target="_blank" rel="nofollow">Anchored positioning</a>] popup の位置を他の要素に紐付けられるよう、CSS anchored positioning scheme という別のプロポーザルも策定予定。ただ現状も <code>anchor</code> 属性を指定すると別の要素に紐付けることができる</li>
<li>[<a href="https://github.com/MicrosoftEdge/MSEdgeExplainers/blob/main/Popup/explainer.md#alternate-solutions-considered" target="_blank" rel="nofollow">Alternate Solutions Considered</a>] 別のソリューションとして <code>&#x3C;dialog></code> 要素の拡張も考えたけど、popup と dialog で期待する機能が違うのでやめた。たとえば
<ul>
<li>popup は軽量な UI で、ユーザーが他の UI を操作したときなどに自動的に消えてほしいけど、dialog は一般的にユーザーが明示的に閉じないと消えない</li>
<li>popup は一度に 1 つしか表示できないが、dialog はそうとは限らない</li>
<li>dialog を表示したとき popup は非表示になるべきだけど、逆はそうとは限らない</li>
</ul>
</li>
<li>[<a href="https://github.com/MicrosoftEdge/MSEdgeExplainers/blob/main/Popup/explainer.md#areas-for-exploration" target="_blank" rel="nofollow">Areas for exploration</a>] 表示・非表示を手続き的に書かないといけないのかーと思ったけど、宣言的に書けるような属性も検討するかも</li>
</ul>
<hr>
<h3 id="how-we-improved-smashingmag-performance"><a href="#how-we-improved-smashingmag-performance" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><a href="https://www.smashingmagazine.com/2021/01/smashingmag-performance-case-study/" target="_blank" rel="nofollow">How We Improved SmashingMag Performance</a></h3>
<ul>
<li>共有者: @b4h0-c4t</li>
</ul>
<h4 id="一行まとめ"><a href="#%E4%B8%80%E8%A1%8C%E3%81%BE%E3%81%A8%E3%82%81" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>一行まとめ</h4>
<p>JAMStack 上で React を使って構築した Web サイトのパフォーマンスを最適化し、Core Web Vitals のメトリクスを改善した手法の話。</p>
<h4 id="序文"><a href="#%E5%BA%8F%E6%96%87" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>序文</h4>
<p>Web パフォーマンスについての話の多くはオーバーホールから始まる。
一方で、時間経過による機能追加の結果コードの断片化やサードパーティスクリプトの読み込み高速化のための "fourth-party" スクリプトが入ってしまう。</p>
<p>実際、smashing 社もパフォーマンスへの目標をしばしば忘れていた結果、Lighthouse スコアがボロボロになっていた。</p>
<h4 id="thats-where-we-were"><a href="#thats-where-we-were" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>That’s Where We Were</h4>
<p>対象サービス(おそらくブログ)は JAMStack 上で Hugo + React を用いて構築されている。
記事のビルドには 6 分近く掛かり、CSS の注入、Webpack のコード分割、広告・昨日の動的挿入 RSS 生成、エッジに配信するための AB テスト等のビルドプロセスが走っていた。</p>
<h4 id="identifying-bottlenecks"><a href="#identifying-bottlenecks" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Identifying Bottlenecks</h4>
<p>ボトルネックを特定するためにいくつかのパフォーマンス評価を実施した。</p>
<p>LCP の結果、5-9 月あたりからパフォーマンスの悪化が見られた。
この時期はナビゲーションバーのリリースを実施していたことから、この指標からボトルネックを特定するのは容易だった。</p>
<p>サービスのリクエストマップを調べた当初は特に問題はなさそうだった。
しかし、特定の条件下で DOM のサイズが爆発的に大きくなることを発見した。
主要なページのみを計測対象とした結果発見できていなかったが、埋め込み等が多く用いられている記事を計測した際は膨大なリクエストが行き来していることがわかった。</p>
<h4 id="やったこと"><a href="#%E3%82%84%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>やったこと</h4>
<ul>
<li>head の読み込み順序改善</li>
<li>特に重要な CSS の手動生成</li>
<li>Web フォントの読込変更</li>
<li>モノリシックな JS の特定と分解</li>
<li>サードパーティコンテンツの適切な割り当て(レイアウト)</li>
<li>体験の向上(AVIF 生成や著作画像のプリロード等)</li>
</ul>
<h4 id="どうなったか"><a href="#%E3%81%A9%E3%81%86%E3%81%AA%E3%81%A3%E3%81%9F%E3%81%8B" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>どうなったか</h4>
<ul>
<li>Lighthouse のスコアはかなり改善した。
インタラクティブタイムとブロッキングタイムが今後の課題で、CSS サイズの縮小やモバイル用のバンドルも検討している。</li>
</ul>
<hr>
<h3 id="upgrading-devtools-architecture-to-the-modern-web"><a href="#upgrading-devtools-architecture-to-the-modern-web" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><a href="https://youtu.be/BHogHiiyuQk" target="_blank" rel="nofollow">Upgrading DevTools' architecture to the modern web</a></h3>
<ul>
<li>共有者: @toshi__toma</li>
</ul>
<p>2020 年の Chrome DevSummit の動画で、Chrome DevTools が取り組んだアーキテクチャの移行についての動画。</p>
<p>取り組んだもの</p>
<ul>
<li>モジュールシステム
<ul>
<li>Custom Module System を JavaScript Modules へ</li>
</ul>
</li>
<li>型システム
<ul>
<li>Closure Compiler を TypeScript Compiler へ</li>
</ul>
</li>
<li>ビルドシステム
<ul>
<li>Python Scripts を Rollup へ</li>
</ul>
</li>
<li>コンポーネント
<ul>
<li>独自の Custom Components を Web Components へ</li>
</ul>
</li>
</ul>
<p>DevTools は、大規模で歴史の長い Web アプリケーションなので、それらの移行をどのように進めたのか、移行での学びなどがまとまってる。
移行の計画・実施・管理の 3 つについて説明されていて、とても参考になるものが多かったです。</p>
<hr>
</div><h2>フロントエンドエキスパートチームについて</h2><style data-emotion="css gz8dae">.css-gz8dae{padding:20px;}</style><div class="css-gz8dae"></div><p style="margin-bottom:0"><a href="https://speakerdeck.com/cybozuinsideout/frontendexpert-team" target="_blank" rel="nofollow noopener noreferrer">https://speakerdeck.com/cybozuinsideout/frontendexpert-team</a></p></article></main><footer class="footer"><a href="/frontend-monthly/">Cybozu Frontend Monthly</a></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"membersPhotoUrl":{"@koba04":"/assets/photo/f8079885d680213e64e4d706daa4a5ee_400x400.jpeg","@pirosikick":"/assets/photo/a95b52be00e06cd293a6853bc36490bc_400x400.jpeg","@toshi__toma":"/assets/photo/fGX7e5wk_400x400.jpg","@zaki___yama":"/assets/photo/Q_ihmvTQ_400x400.png","@__sakito__":"/assets/photo/erghEqaW_400x400.png","@shisama_":"/assets/photo/A9M8G6DH_400x400.jpg","@nakajmg":"/assets/photo/EKNVNzOg_400x400.jpg","@b4h0_c4t":"/assets/photo/QySbTwnO_400x400.jpg","@__sosukesuzuki":"/assets/photo/7iJNhdua_400x400.jpg"},"frontmatter":{"title":"Cybozu Frontend Monthly","date":"2021-01-26T17:00:00+09:00","slug":"2021-01","connpass":"https://cybozu.connpass.com/event/202029/","streamUrl":"https://www.youtube.com/watch?v=MMFzKjIzdRA","no":7,"members":[{"name":"@koba04","link":"https://twitter.com/koba04"},{"name":"@pirosikick","link":"https://twitter.com/pirosikick"},{"name":"@toshi__toma","link":"https://twitter.com/toshi__toma"},{"name":"@zaki___yama","link":"https://twitter.com/zaki___yama"},{"name":"@__sakito__","link":"https://twitter.com/__sakito__"},{"name":"@shisama_","link":"https://twitter.com/shisama_"},{"name":"@nakajmg","link":"https://twitter.com/nakajmg"},{"name":"@b4h0_c4t","link":"https://twitter.com/b4h0_c4t"},{"name":"@__sosukesuzuki","link":"https://twitter.com/__sosukesuzuki"}],"guest":null},"html":"\u003ch3 id=\"javascript-アンケート周り\"\u003e\u003ca href=\"#javascript-%E3%82%A2%E3%83%B3%E3%82%B1%E3%83%BC%E3%83%88%E5%91%A8%E3%82%8A\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eJavaScript アンケート周り\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e共有者: @__sakito__\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://2020.stateofjs.com/en-US/\" target=\"_blank\" rel=\"nofollow\"\u003eState of JS 2020\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://2020.stateofjs.com/ja-JP/\" target=\"_blank\" rel=\"nofollow\"\u003e日本語訳\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://risingstars.js.org/2020/en\" target=\"_blank\" rel=\"nofollow\"\u003e2020 JavaScript Rising Stars\u003c/a\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://risingstars.js.org/2020/ja\" target=\"_blank\" rel=\"nofollow\"\u003e日本語訳\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e両方とも 2020 年の流れを把握するのに使えそうです。\u003c/p\u003e\n\u003cp\u003eState of JS は、ビルドが esbuild や sbowpack、フレームワークは引き続き svelte に興味持ってる人が多かったです。\nしかし実際に使用してるものは、webpack などになっており、新しいものはまだプロダクションで使用するには踏み込めない印象。\n各項目で色々な人が 2020 年の個人的ベストを紹介してるのが面白かった、\u003ca href=\"https://github.com/atlassian/changesets\" target=\"_blank\" rel=\"nofollow\"\u003echangesets\u003c/a\u003e、\u003ca href=\"https://insomnia.rest/\" target=\"_blank\" rel=\"nofollow\"\u003eInsomnia\u003c/a\u003e、\u003ca href=\"https://redwoodjs.com/\" target=\"_blank\" rel=\"nofollow\"\u003eRedwood\u003c/a\u003eなど知らないものを知れました。\u003c/p\u003e\n\u003cp\u003e2020 JavaScript Rising Stars は、あくまでスター数なので State of JS 2020 と見比べて世間がどこに注目しているか照らし合わせるとよさそうです。\n各セクションで説明もあるので、なぜスター数が増えたのかもわかりやすいです。\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 id=\"dont-use-inverted-color-cues-on-toggle-buttons\"\u003e\u003ca href=\"#dont-use-inverted-color-cues-on-toggle-buttons\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e\u003ca href=\"https://uxmovement.com/buttons/dont-use-inverted-color-cues-on-toggle-buttons/\" target=\"_blank\" rel=\"nofollow\"\u003eDon’t Use Inverted Color Cues on Toggle Buttons\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e共有者: @pirosikick\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eトグルボタンでボタンの文字色と背景色を反転させた ON・OFF ボタンを作りがちだが、\n色のコントラスト比が同じになるのでどちらが ON で OFF なのかわからず誤操作が増えがちなので気をつけなはれや、という内容。\nブログの画像を見ると分かりやすいですが、色の反転の代わりに奥行きで ON/OFF を表現するといいよとのことです。\n最近、tailwind.css を使っていて悪い例と同じようなことをしていたので、タイムリーで参考になりました。\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 id=\"classi-にフロントエンドエキスパートチームを作った話\"\u003e\u003ca href=\"#classi-%E3%81%AB%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89%E3%82%A8%E3%82%AD%E3%82%B9%E3%83%91%E3%83%BC%E3%83%88%E3%83%81%E3%83%BC%E3%83%A0%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%9F%E8%A9%B1\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e\u003ca href=\"https://tech.classi.jp/entry/2021/01/18/103110\" target=\"_blank\" rel=\"nofollow\"\u003eClassi にフロントエンドエキスパートチームを作った話\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e共有者: @nakajmg\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eClassi さんがフロントエンドエキスパートチームを作った話。\n弊チームを参考にしてくれたとのことで、私達の活動が界隈に影響を与えられていると思うと嬉しいですね。\u003c/p\u003e\n\u003cp\u003e記事中では\u003ca href=\"https://giamir.com/frontendops\" target=\"_blank\" rel=\"nofollow\"\u003eFrontendOps\u003c/a\u003eについて触れており、フロントエンドの運用が開発者だけの関心事ではなく、チーム全員にとって重要であると説明しています。\n今後ますますフロントエンドの運用は重要な関心事となっていくと思いますので、弊フロントエンドエキスパートチームとしても真摯に向き合って行きたいです。\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 id=\"front-end-performance-checklist-2021--smashing-magazine\"\u003e\u003ca href=\"#front-end-performance-checklist-2021--smashing-magazine\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e\u003ca href=\"https://www.smashingmagazine.com/2021/01/front-end-performance-2021-free-pdf-checklist/\" target=\"_blank\" rel=\"nofollow\"\u003eFront-End Performance Checklist 2021 — Smashing Magazine\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e共有者: @shisama\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eパフォーマンスに関するチェックリストです。\u003cbr\u003e\n77 個のチェックリストがありますが、長大なので挫折しそうな人はサマライズされている \u003ca href=\"https://www.dropbox.com/s/34noajrbm324iai/performance-checklist-1.4.pdf\" target=\"_blank\" rel=\"nofollow\"\u003ePDF 版\u003c/a\u003e を読んでみて気になるところは記事の方を読んでみるのが良いかと思います。\u003c/p\u003e\n\u003cp\u003e記事の最後には\u003cstrong\u003eQuic Wins\u003c/strong\u003eとして 1 時間で改善できる 17 個のことを記事中からピックアップされているので、まずはこれからはじめるのも良さそうです。\u003cbr\u003e\n個人的には「パフォーマンスの文化を作る」が最初に来ているところがいいと思いました。\u003c/p\u003e\n\u003cp\u003eパフォーマンスに関連する話で今月知ったものもあわせて紹介しておきます。\u003c/p\u003e\n\u003cp\u003eこの記事の中でも CoreWebVitals を使って計測する話があり、DevTools で計測したり、\u003ca href=\"https://chrome.google.com/webstore/detail/web-vitals/ahfhijdlegdabablpippeagghigmibma?hl=en\" target=\"_blank\" rel=\"nofollow\"\u003eChrome 拡張\u003c/a\u003eを使っている人が多いと思いますが、Chrome 90 からは Experimental ですが Chrome 本体でもメトリクスを常に監視できるようになるようです。\u003cbr\u003e\n\u003ca href=\"https://addyosmani.com/blog/performance-hud/\" target=\"_blank\" rel=\"nofollow\"\u003eAddyOsmani.com - A Performance Heads-Up Display (HUD) for Chrome\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eJS のサイズについては、モダンブラウザで使える JS の構文を使うことでバンドルサイズを減らせると紹介されています。\u003cbr\u003e\nJS のネイティブに置き換えることでどれくらいバンドルサイズを減らせるかをチェックするツールがあるので、試してみるといいかもしれません。\u003cbr\u003e\n\u003ca href=\"https://estimator.dev/\" target=\"_blank\" rel=\"nofollow\"\u003eEStimator.dev: the modern JavaScript savings calculator\u003c/a\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 id=\"agenda-for-the-80th-meeting-of-ecma-tc39\"\u003e\u003ca href=\"#agenda-for-the-80th-meeting-of-ecma-tc39\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e\u003ca href=\"https://github.com/tc39/agendas/blob/master/2021/01.md\" target=\"_blank\" rel=\"nofollow\"\u003eAgenda for the 80th meeting of Ecma TC39\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eTC39 の１月のミーティングのアジェンダです。25 日~28 日にかけて行われます。\u003c/p\u003e\n\u003cp\u003eこのミーティングでは多くのプロポーザルについての議論が行われる予定です。\u003c/p\u003e\n\u003ch4 id=\"intl-系ecma402のプロポーザル\"\u003e\u003ca href=\"#intl-%E7%B3%BBecma402%E3%81%AE%E3%83%97%E3%83%AD%E3%83%9D%E3%83%BC%E3%82%B6%E3%83%AB\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e\u003ca href=\"https://github.com/tc39/ecma402\" target=\"_blank\" rel=\"nofollow\"\u003eIntl 系(ECMA402)\u003c/a\u003eのプロポーザル\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/tc39/proposal-intl-DateTimeFormat-formatRange\" target=\"_blank\" rel=\"nofollow\"\u003eIntl.DateTimeFormat.prototype.formatRange\u003c/a\u003e for Stage 4\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/tc39/proposal-intl-locale-info\" target=\"_blank\" rel=\"nofollow\"\u003eIntl Locale Info\u003c/a\u003e for stage 2\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/tc39/intl-displaynames-v2\" target=\"_blank\" rel=\"nofollow\"\u003eIntl DisplayNames\u003c/a\u003e v2 for stage 2\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/Louis-Aime/proposal-intl-eradisplay\" target=\"_blank\" rel=\"nofollow\"\u003eeraDisplay option for Intl.DateTimeFormat\u003c/a\u003e for stage 1\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/longlho/proposal-intl-localematcher\" target=\"_blank\" rel=\"nofollow\"\u003eIntl LocaleMatcher\u003c/a\u003e for Stage 1\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/FrankYFTang/proposal-intl-extend-timezonename/\" target=\"_blank\" rel=\"nofollow\"\u003eExtend TimeZoneName Option Proposal\u003c/a\u003e for stage 1\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"新しい構文を追加するプロポーザル\"\u003e\u003ca href=\"#%E6%96%B0%E3%81%97%E3%81%84%E6%A7%8B%E6%96%87%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B%E3%83%97%E3%83%AD%E3%83%9D%E3%83%BC%E3%82%B6%E3%83%AB\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e新しい構文を追加するプロポーザル\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e⭐\u003ca href=\"https://github.com/tc39/proposal-class-static-block\" target=\"_blank\" rel=\"nofollow\"\u003eClass static Initialization Blocks\u003c/a\u003e for Stage 3\u003c/li\u003e\n\u003cli\u003e⭐\u003ca href=\"https://github.com/tc39/proposal-js-module-blocks\" target=\"_blank\" rel=\"nofollow\"\u003eJS Module Blocks\u003c/a\u003e for stage 2\u003c/li\u003e\n\u003cli\u003e⭐\u003ca href=\"https://github.com/bakkot/do-expressions-v2\" target=\"_blank\" rel=\"nofollow\"\u003edo expressions\u003c/a\u003e for stage 2\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/bakkot/proposal-async-do-expressions\" target=\"_blank\" rel=\"nofollow\"\u003easync do expressions\u003c/a\u003e for stage 1\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/mathiasbynens/proposal-regexp-set-notation\" target=\"_blank\" rel=\"nofollow\"\u003eAdopting Unicode behavior for set notation in regular expressions\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/codehag/proposal-lazy-import\" target=\"_blank\" rel=\"nofollow\"\u003edefer module import eval\u003c/a\u003e for stage 1\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"新しい-api-を追加するプロポーザル\"\u003e\u003ca href=\"#%E6%96%B0%E3%81%97%E3%81%84-api-%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B%E3%83%97%E3%83%AD%E3%83%9D%E3%83%BC%E3%82%B6%E3%83%AB\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e新しい API を追加するプロポーザル\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e⭐\u003ca href=\"https://github.com/tc39/proposal-relative-indexing-method\" target=\"_blank\" rel=\"nofollow\"\u003eRelative indexing method\u003c/a\u003e for stage 4\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/tc39/proposal-array-is-template-object\" target=\"_blank\" rel=\"nofollow\"\u003eArray.isTemplateObject\u003c/a\u003e for stage 3\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/tc39/proposal-temporal\" target=\"_blank\" rel=\"nofollow\"\u003eTemporal\u003c/a\u003e updates\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/tc39/proposal-resizablearraybuffer\" target=\"_blank\" rel=\"nofollow\"\u003eResizableArrayBuffer and GrowableSharedArrayBuffer\u003c/a\u003e updates\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/tc39/proposal-realms\" target=\"_blank\" rel=\"nofollow\"\u003eRealms\u003c/a\u003e update\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/Kingwl/proposal-array-find-from-last\" target=\"_blank\" rel=\"nofollow\"\u003eArray find from last\u003c/a\u003e for stage 1\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"その他\"\u003e\u003ca href=\"#%E3%81%9D%E3%81%AE%E4%BB%96\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eその他\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/tc39/proposal-private-fields-in-in\" target=\"_blank\" rel=\"nofollow\"\u003eErgonomic brand checks for private fields\u003c/a\u003e for stage 3\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/tc39/proposal-dynamic-code-brand-checks\" target=\"_blank\" rel=\"nofollow\"\u003eDynamic code brand checks\u003c/a\u003e for stage 2\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/hax/proposal-class-brand-check\" target=\"_blank\" rel=\"nofollow\"\u003eclass brand check\u003c/a\u003e for stage 1\u003c/li\u003e\n\u003cli\u003e⭐\u003ca href=\"https://github.com/tc39/proposal-json-modules\" target=\"_blank\" rel=\"nofollow\"\u003eJSON modules\u003c/a\u003e for stage 3\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/tc39/proposal-regexp-match-indices\" target=\"_blank\" rel=\"nofollow\"\u003eRegExp Match Indices\u003c/a\u003e update\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e数が多くて全部は紹介しきれないので、僕が個人的に気になったもの、多くの JavaScript 開発者にとって影響が大きそうなもの、かつステージが進みそうなものを紹介していきます。\u003c/p\u003e\n\u003cdetails\u003e\n  \u003cdiv\u003e\n\u003ch4 id=\"class-static-initilization-blocks-for-stage-3\"\u003e\u003ca href=\"#class-static-initilization-blocks-for-stage-3\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eClass static initilization Blocks for Stage 3\u003c/h4\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/tc39/proposal-class-static-block\" target=\"_blank\" rel=\"nofollow\"\u003ehttps://github.com/tc39/proposal-class-static-block\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eこれは、クラスのスタティックプロパティの初期化を行うことができるブロックの構文を導入するプロポーザルです。\u003c/p\u003e\n\u003cp\u003e今のクラスの仕様だと、何かしらの外部の計算に依存してスタティックプロパティを決定したいとき、クラスの中だけでは不可能でした。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eC\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e x \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token spread operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e y\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword control-flow\"\u003etry\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e obj \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003edoSomething\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token constant\"\u003eC\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ex\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token constant\"\u003eC\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ey\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e obj\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ey\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ecatch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// doSomething が失敗したときのフォールバック\u003c/span\u003e\n  \u003cspan class=\"token constant\"\u003eC\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ey\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token spread operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eこのプロポーザルで追加するクラススタティックブロックを使うと、このような処理をクラス内のブロックに書くことができます。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eC\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e x \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token spread operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e y\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003etry\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e obj \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003edoSomething\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ex\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ey\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e obj\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ey\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ecatch\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003ethis\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ey\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token spread operator\"\u003e...\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch4 id=\"js-module-blocks-for-stage-2\"\u003e\u003ca href=\"#js-module-blocks-for-stage-2\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eJS Module Blocks for Stage 2\u003c/h4\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/tc39/proposal-js-module-blocks\" target=\"_blank\" rel=\"nofollow\"\u003ehttps://github.com/tc39/proposal-js-module-blocks\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eちょっと前のマンスリーでも紹介しました。\u003c/p\u003e\n\u003cp\u003eインラインでモジュールを定義できる新しい式の構文を導入するプロポーザル。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e moduleBlock \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e module \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e y \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e moduleExports \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emoduleBlock\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token function\"\u003eassert\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emoduleExports\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ey\u003c/span\u003e \u003cspan class=\"token operator\"\u003e===\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003emodule 式で作ったモジュールは、Worker コンストラクタにそのまま渡すことができます。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e workerCode \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e module \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token function-variable function\"\u003eonmessage\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e mod \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eawait\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003epostMessage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emod\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003efn\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e worker \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eWorker\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eworkerCode\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003etype\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"module\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\nworker\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method-variable function-variable method function property-access\"\u003eonmessage\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token function\"\u003ealert\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\nworker\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003epostMessage\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodule \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003efn\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"hello!\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e著者のツイートからすでにステージ 2 にあがっているようです。\u003c/p\u003e\n\u003ch4 id=\"do-expression-for-stage-2\"\u003e\u003ca href=\"#do-expression-for-stage-2\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e\u003ccode\u003edo\u003c/code\u003e expression for Stage 2\u003c/h4\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/bakkot/do-expressions-v2\" target=\"_blank\" rel=\"nofollow\"\u003ehttps://github.com/bakkot/do-expressions-v2\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e長らく Stage 1 のままだった \u003ccode\u003edo\u003c/code\u003e expression です。\u003c/p\u003e\n\u003cp\u003eブロックの中で最後の評価されたものが式の結果になります。また、変数のスコープは \u003ccode\u003edo\u003c/code\u003e のブロックの中で閉じます。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e x \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003edo\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e tmp \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ef\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  tmp \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e tmp \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e読みにくいネストした三項演算子の代わりに \u003ccode\u003eif else\u003c/code\u003e で書けるようになります。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e x \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003edo\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003efoo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003ef\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eelse\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003ebar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003eg\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eelse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003eh\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e特に、JSX などの中に書くと便利です。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-jsx\"\u003e\u003ccode class=\"language-jsx\"\u003e\u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003enav\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\u003c/span\u003e\n\u003cspan class=\"token plain-text\"\u003e    \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eHome\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\u003c/span\u003e\n\u003cspan class=\"token plain-text\"\u003e    \u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token keyword control-flow\"\u003edo\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eloggedIn\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eLogoutButton\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003eelse\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eLoginButton\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\u003c/span\u003e\n\u003cspan class=\"token plain-text\"\u003e  \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003enav\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch4 id=\"relative-indexing-method\"\u003e\u003ca href=\"#relative-indexing-method\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eRelative indexing method\u003c/h4\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/tc39/proposal-relative-indexing-method\" target=\"_blank\" rel=\"nofollow\"\u003ehttps://github.com/tc39/proposal-relative-indexing-method\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eArray.prototype.at\u003c/code\u003e のことです。\u003c/p\u003e\n\u003cp\u003e配列の後ろから要素を取得するのが楽になります。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e arr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"a\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"b\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"c\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"d\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\narr\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eat\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// \"a\"\u003c/span\u003e\narr\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eat\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// \"b\"\u003c/span\u003e\narr\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eat\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// \"d\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch4 id=\"json-modules-for-stage-3\"\u003e\u003ca href=\"#json-modules-for-stage-3\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eJSON modules for Stage 3\u003c/h4\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/tc39/proposal-json-modules\" target=\"_blank\" rel=\"nofollow\"\u003ehttps://github.com/tc39/proposal-json-modules\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eJSON を JavaScript からモジュールとして読み込むときの挙動についての仕様です。\u003c/p\u003e\n\u003cp\u003eもともとは、\u003ca href=\"https://github.com/tc39/proposal-import-assertions/\" target=\"_blank\" rel=\"nofollow\"\u003eImport Assertions\u003c/a\u003eの一部でしたが別の仕様として切り出されました。\u003c/p\u003e\n\u003cp\u003eブラウザ上では JSON modules を使う場合は、セキュリティ上の都合から Import Assertions の構文を使って import する必要があります。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003ejson\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"./foo.json\"\u003c/span\u003e assert \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"json\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"foo.json\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e assert\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e type\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"json\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eただ、これはブラウザ特有のセキュリティの問題なので、JSON modules を import するときにアサートを必須にするかどうかは各ランタイムに委ねられています(Import Assertions の構文を解釈できる必要はある)。\u003c/p\u003e\n\u003cp\u003e次のような JSON を考えます。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"foo\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"ふー\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"bar\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"ばー\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eこれを JavaScript から import するときは default export として解釈します。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003ejson\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"./foobar.json\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ejson\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003efoo\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// ふー\u003c/span\u003e\n\u003cspan class=\"token console class-name\"\u003econsole\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003elog\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ejson\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003ebar\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// ばー\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eJSON のキーには JavaScript の識別子として妥当でないものを使用できるため、named export はサポートされていません。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-json\"\u003e\u003ccode class=\"language-json\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003e\"32\"\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"さんじゅうに\"\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"token comment\"\u003e// 数字は識別子として認められていない\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token number\"\u003e32\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"numbers.json\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n  \u003c/div\u003e\n\u003c/details\u003e\n\u003chr\u003e\n\u003ch3 id=\"enabling-popups---microsoftedgemsedgeexplainers\"\u003e\u003ca href=\"#enabling-popups---microsoftedgemsedgeexplainers\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e\u003ca href=\"https://github.com/MicrosoftEdge/MSEdgeExplainers/blob/main/Popup/explainer.md\" target=\"_blank\" rel=\"nofollow\"\u003eEnabling Popups - MicrosoftEdge/MSEdgeExplainers\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e共有者: @zaki___yama\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ca href=\"https://cybozu.github.io/frontend-monthly/posts/2020-08\" target=\"_blank\" rel=\"nofollow\"\u003e以前の Frontend Monthly\u003c/a\u003eで \"\u003ca href=\"https://github.com/MicrosoftEdge/MSEdgeExplainers/blob/main/ControlUICustomization/explainer.md\" target=\"_blank\" rel=\"nofollow\"\u003eEnabling Custom Control UI\u003c/a\u003e\" というプロポーザルを紹介したんですが、その続編みたいなプロポーザルです。\nといってもその後の動向を熱心にウォッチしてたわけではなく、例によって Edge の PM の\u003ca href=\"https://twitter.com/soMelanieSaid/status/1352324867941568512?s=20\" target=\"_blank\" rel=\"nofollow\"\u003eツイート\u003c/a\u003e から知りました。\u003c/p\u003e\n\u003ch4 id=\"概要\"\u003e\u003ca href=\"#%E6%A6%82%E8%A6%81\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e概要\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e\u0026#x3C;popup\u003e\u003c/code\u003e という新しい HTML 要素の提案です\u003c/li\u003e\n\u003cli\u003e他の HTML 要素と同じようにマークアップを書き、 \u003ccode\u003eshow()/hide()\u003c/code\u003e メソッドで表示／非表示を制御します\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-html\"\u003e\u003ccode class=\"language-html\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ebutton\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003earia-haspopup\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003etrue\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003earia-controls\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003emenuPopup\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eid\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003emenuButton\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  Menu\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ebutton\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003epopup\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eid\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003emenuPopup\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003erole\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003emenu\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eanchor\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003emenuButton\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e\u0026#x3C;!-- Markup for menuitems goes here --\u003e\u003c/span\u003e\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003epopup\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token dom variable\"\u003edocument\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003egetElementById\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"menuButton\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eaddEventListener\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"click\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token dom variable\"\u003edocument\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003egetElementById\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"menuPopup\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003eshow\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003epopup\u003c/code\u003e は独立した要素の可能性もあるし、combobox のようなより大きな複合的な(composited)コンポーネントの一部の可能性もあります\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"面白いと思ったポイントいくつか\"\u003e\u003ca href=\"#%E9%9D%A2%E7%99%BD%E3%81%84%E3%81%A8%E6%80%9D%E3%81%A3%E3%81%9F%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%81%84%E3%81%8F%E3%81%A4%E3%81%8B\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e面白いと思ったポイントいくつか\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003epopup は以下の挙動をする。これらの挙動をプロポーザル中では \"light dismiss\" と表現している\n\u003cul\u003e\n\u003cli\u003eユーザーが Escape キーを押した\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003epopup\u003c/code\u003e またはそのアンカー要素の layout が変更された\u003c/li\u003e\n\u003cli\u003eフォーカスが外れた\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e[\u003ca href=\"https://github.com/MicrosoftEdge/MSEdgeExplainers/blob/main/Popup/explainer.md#anchored-positioning\" target=\"_blank\" rel=\"nofollow\"\u003eAnchored positioning\u003c/a\u003e] popup の位置を他の要素に紐付けられるよう、CSS anchored positioning scheme という別のプロポーザルも策定予定。ただ現状も \u003ccode\u003eanchor\u003c/code\u003e 属性を指定すると別の要素に紐付けることができる\u003c/li\u003e\n\u003cli\u003e[\u003ca href=\"https://github.com/MicrosoftEdge/MSEdgeExplainers/blob/main/Popup/explainer.md#alternate-solutions-considered\" target=\"_blank\" rel=\"nofollow\"\u003eAlternate Solutions Considered\u003c/a\u003e] 別のソリューションとして \u003ccode\u003e\u0026#x3C;dialog\u003e\u003c/code\u003e 要素の拡張も考えたけど、popup と dialog で期待する機能が違うのでやめた。たとえば\n\u003cul\u003e\n\u003cli\u003epopup は軽量な UI で、ユーザーが他の UI を操作したときなどに自動的に消えてほしいけど、dialog は一般的にユーザーが明示的に閉じないと消えない\u003c/li\u003e\n\u003cli\u003epopup は一度に 1 つしか表示できないが、dialog はそうとは限らない\u003c/li\u003e\n\u003cli\u003edialog を表示したとき popup は非表示になるべきだけど、逆はそうとは限らない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e[\u003ca href=\"https://github.com/MicrosoftEdge/MSEdgeExplainers/blob/main/Popup/explainer.md#areas-for-exploration\" target=\"_blank\" rel=\"nofollow\"\u003eAreas for exploration\u003c/a\u003e] 表示・非表示を手続き的に書かないといけないのかーと思ったけど、宣言的に書けるような属性も検討するかも\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 id=\"how-we-improved-smashingmag-performance\"\u003e\u003ca href=\"#how-we-improved-smashingmag-performance\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e\u003ca href=\"https://www.smashingmagazine.com/2021/01/smashingmag-performance-case-study/\" target=\"_blank\" rel=\"nofollow\"\u003eHow We Improved SmashingMag Performance\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e共有者: @b4h0-c4t\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"一行まとめ\"\u003e\u003ca href=\"#%E4%B8%80%E8%A1%8C%E3%81%BE%E3%81%A8%E3%82%81\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e一行まとめ\u003c/h4\u003e\n\u003cp\u003eJAMStack 上で React を使って構築した Web サイトのパフォーマンスを最適化し、Core Web Vitals のメトリクスを改善した手法の話。\u003c/p\u003e\n\u003ch4 id=\"序文\"\u003e\u003ca href=\"#%E5%BA%8F%E6%96%87\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e序文\u003c/h4\u003e\n\u003cp\u003eWeb パフォーマンスについての話の多くはオーバーホールから始まる。\n一方で、時間経過による機能追加の結果コードの断片化やサードパーティスクリプトの読み込み高速化のための \"fourth-party\" スクリプトが入ってしまう。\u003c/p\u003e\n\u003cp\u003e実際、smashing 社もパフォーマンスへの目標をしばしば忘れていた結果、Lighthouse スコアがボロボロになっていた。\u003c/p\u003e\n\u003ch4 id=\"thats-where-we-were\"\u003e\u003ca href=\"#thats-where-we-were\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eThat’s Where We Were\u003c/h4\u003e\n\u003cp\u003e対象サービス(おそらくブログ)は JAMStack 上で Hugo + React を用いて構築されている。\n記事のビルドには 6 分近く掛かり、CSS の注入、Webpack のコード分割、広告・昨日の動的挿入 RSS 生成、エッジに配信するための AB テスト等のビルドプロセスが走っていた。\u003c/p\u003e\n\u003ch4 id=\"identifying-bottlenecks\"\u003e\u003ca href=\"#identifying-bottlenecks\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eIdentifying Bottlenecks\u003c/h4\u003e\n\u003cp\u003eボトルネックを特定するためにいくつかのパフォーマンス評価を実施した。\u003c/p\u003e\n\u003cp\u003eLCP の結果、5-9 月あたりからパフォーマンスの悪化が見られた。\nこの時期はナビゲーションバーのリリースを実施していたことから、この指標からボトルネックを特定するのは容易だった。\u003c/p\u003e\n\u003cp\u003eサービスのリクエストマップを調べた当初は特に問題はなさそうだった。\nしかし、特定の条件下で DOM のサイズが爆発的に大きくなることを発見した。\n主要なページのみを計測対象とした結果発見できていなかったが、埋め込み等が多く用いられている記事を計測した際は膨大なリクエストが行き来していることがわかった。\u003c/p\u003e\n\u003ch4 id=\"やったこと\"\u003e\u003ca href=\"#%E3%82%84%E3%81%A3%E3%81%9F%E3%81%93%E3%81%A8\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eやったこと\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003ehead の読み込み順序改善\u003c/li\u003e\n\u003cli\u003e特に重要な CSS の手動生成\u003c/li\u003e\n\u003cli\u003eWeb フォントの読込変更\u003c/li\u003e\n\u003cli\u003eモノリシックな JS の特定と分解\u003c/li\u003e\n\u003cli\u003eサードパーティコンテンツの適切な割り当て(レイアウト)\u003c/li\u003e\n\u003cli\u003e体験の向上(AVIF 生成や著作画像のプリロード等)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"どうなったか\"\u003e\u003ca href=\"#%E3%81%A9%E3%81%86%E3%81%AA%E3%81%A3%E3%81%9F%E3%81%8B\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eどうなったか\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003eLighthouse のスコアはかなり改善した。\nインタラクティブタイムとブロッキングタイムが今後の課題で、CSS サイズの縮小やモバイル用のバンドルも検討している。\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 id=\"upgrading-devtools-architecture-to-the-modern-web\"\u003e\u003ca href=\"#upgrading-devtools-architecture-to-the-modern-web\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e\u003ca href=\"https://youtu.be/BHogHiiyuQk\" target=\"_blank\" rel=\"nofollow\"\u003eUpgrading DevTools' architecture to the modern web\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e共有者: @toshi__toma\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e2020 年の Chrome DevSummit の動画で、Chrome DevTools が取り組んだアーキテクチャの移行についての動画。\u003c/p\u003e\n\u003cp\u003e取り組んだもの\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eモジュールシステム\n\u003cul\u003e\n\u003cli\u003eCustom Module System を JavaScript Modules へ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e型システム\n\u003cul\u003e\n\u003cli\u003eClosure Compiler を TypeScript Compiler へ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eビルドシステム\n\u003cul\u003e\n\u003cli\u003ePython Scripts を Rollup へ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eコンポーネント\n\u003cul\u003e\n\u003cli\u003e独自の Custom Components を Web Components へ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eDevTools は、大規模で歴史の長い Web アプリケーションなので、それらの移行をどのように進めたのか、移行での学びなどがまとまってる。\n移行の計画・実施・管理の 3 つについて説明されていて、とても参考になるものが多かったです。\u003c/p\u003e\n\u003chr\u003e\n"},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"2021-01"},"buildId":"D_S-f2v3rZUXwnRGG-ZyZ","assetPrefix":"/frontend-monthly","runtimeConfig":{"basePath":"/frontend-monthly"},"isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>