---
title: Cybozu Frontend Monthly
date: "2021-07-27T17:00:00+09:00"
slug: "2021-07"
connpass: "https://cybozu.connpass.com/event/218880/"
streamUrl: "https://www.youtube.com/watch?v=SAEzDJE2Uqw"
no: 13
members:
  - name: "@koba04"
    link: https://twitter.com/koba04
  - name: "@pirosikick"
    link: https://twitter.com/pirosikick
  - name: "@__sakito__"
    link: https://twitter.com/__sakito__
  - name: "@shisama_"
    link: https://twitter.com/shisama_
  - name: "@nakajmg"
    link: https://twitter.com/nakajmg
  - name: "@b4h0_c4t"
    link: https://twitter.com/b4h0_c4t
  - name: "@__sosukesuzuki"
    link: https://twitter.com/__sosukesuzuki
  - name: "@mugi_uno"
    link: https://twitter.com/mugi_uno
guest:
  - name: "@jmblog"
    link: https://twitter.com/jmblog
  - name: "@MonchiFC"
    link: https://twitter.com/MonchiFC
---

### [The performance effects of too much lazy-loading](https://web.dev/lcp-lazy-loading/)

- 共有者: @shisama_

画像のlazy-loadingはパフォーマンス向上には有効な方法だが、ページ内のすべての画像をlazy-loadingすると、パフォーマンスが悪くなることもある。
WordPressで作られたページで実験したところ、ファーストビュー内の画像はlazy-loadingしないほうが良いパフォーマンス結果を得られた。

以下、記事本文まとめ

- lazy-loadingは画像の読み込みを遅延させてパフォーマンスを改善するためには良い方法だが、使いすぎると逆にパフォーマンスを悪化させることもある
- HTTPアーカイブによると、すでにWebサイトの17%でlazy-loadが使われていて、急速に利用拡大している
- 内訳は84%がWordPress、他のCMSが2%、残り14%となっている
- lazy-loadingを使うWordPressサイトは、1年前は1%だったのに今では14%まで増えた

- Chrome User Experience Report から収集したレポートによると、ページを閲覧したユーザーの75パーセンタイルの中央値はlazy-loadingありよりlazy-loadingなしのほうが高速にページ表示していた
  - lazy-loadingなし: 2,922ms
  - lazy-loadingあり: 3,546ms
- WordPressサイトに絞り込むと遅くなる傾向があった
  - lazy-loadingなし: 3,495ms
  - lazy-loadingあり: 3,768ms
- WordPressのシングルページとアーカイブページをWebPageTestで計測したらアーカイブがlazy-loadingしているほうが遅いことが判明
- ページ内の画像のバイト数の中央値を比較すると、遅延読み込みしているほうがサイズは小さい。
- 要するに、lazy-loadingは画像サイズの削減には役立つが、LCPの結果的には遅い

- ファーストビューでは見えない部分の画像だけをlazy-loadingしてみると結果が改善された
- 画像のバイト数の中央値に変化はなかった
- ただWordPressはどの画像をlazy-loadingさせるかサーバー側で判定しているのでビューポートサイズはわからない
- 画像の相対的な位置をヒューリスティックな方法で判定するようにした
  - 画像が最初の注目すべき画像である場合、またはメインコンテンツの最初の画像の場合はビューポート内（または近い場所）にあると考える
  - 見出しの単語数や序盤の段落のテキスト量によっては画像がビューポートに影響するので考慮する
  - アンカーリンクを使ってスクロール位置を変更する場合も考慮する
- これらの方法は一般的には有効だが、すべてのケースで有効ではないため微調整が必要
- LCPの要素がlazy-loadingされた場合はコンソールに警告を出したりして改善するのが良い

- lazy-loadingを使っている場合は、実装方法を確認してA/Bテストを実行してパフォーマンスを確認すること
- ファーストビューに表示される画像はlazy-loadingではなく、eager loadingすること
- WordPressサイトの運営者はWordPress本体にパッチがリリースされることを願う
- 比較的新しいAPIはリスクとメリットが両方ある。lazy-loadingは厄介な面もあるが、パフォーマンス向上のメリットもある

---

