---
title: Cybozu Frontend Monthly
date: "2021-03-02T17:00:00+09:00"
connpass: "https://cybozu.connpass.com/event/205864/"
streamUrl: ""
no: 8
members:
  - name: "@koba04"
    link: https://twitter.com/koba04
  - name: "@pirosikick"
    link: https://twitter.com/pirosikick
  - name: "@__sakito__"
    link: https://twitter.com/__sakito__
  - name: "@shisama_"
    link: https://twitter.com/shisama_
  - name: "@nakajmg"
    link: https://twitter.com/nakajmg
  - name: "@b4h0_c4t"
    link: https://twitter.com/b4h0_c4t
  - name: "@__sosukesuzuki"
    link: https://twitter.com/__sosukesuzuki
guest:
---

### [SmartHRがInternet Explorerサポート終了のお知らせを出した](https://smarthr.jp/other/22512)

- 共有者: nakajmg

Microsoftが自身のサービスでのIEサポート終了予定を発表してから、国内のサービスからもそれに追従するようにサポート終了のお知らせが出てきています。

SmartHRに続いて[Money ForwardもIEサポート終了のお知らせを出しました](https://support.biz.moneyforward.com/valuepack/news/important/20210226.html)。

背景として挙げているのはセキュリティ面、Microsoft Edgeの存在、そして[Microsoft 365におけるIE11サポート終了の発表](https://blogs.windows.com/japan/2020/08/18/microsoft-365-apps-say-farewell-to-internet-explorer-11/)です。
また、両者ともにIEサポートの終了月をMicrosoft 365のIEサポート終了の日に合わせて2021年8月までとしています。

今後もこの動きに追従する発表が出てきそうです。

---

### [Using AbortController as an Alternative for Removing Event Listeners | CSS-Tricks](https://css-tricks.com/using-abortcontroller-as-an-alternative-for-removing-event-listeners/)

- 共有者: pirosikick

AbortControllerをjQueryのonce関数みたいな一度実行したら消えるタイプのイベントリスナーの代替として使う話。
`mousemove`と`mouseup`のイベントハンドラを、`mouseup`時に両方削除するようなユースケースの場合、AbortControllerを使うとスッキリ書ける。

---

### [Introducing Env: a better way to read environment variables in JavaScript - Human Who Codes](https://humanwhocodes.com/blog/2021/02/introducing-env-javascript-environment-variables/)

- 共有者: pirosikick

ブラウザにサーバーサイドから環境変数を流し込む際に陥りがちな罠と、それを回避するために作られた`@humanwhocodes/env`について。
`env.required`や`env.exists`はProxyで実装されている。
200行くらいのシンプルなコードなので、`@humanwhocodes/env`を参考に自前で環境変数をラップしてアクセスする関数を作るのもよさそう。

---

### [Maximally optimizing image loading for the web in 2021](https://www.industrialempathy.com/posts/image-optimizations/)

- 共有者: b4h0_c4t

Core Web Vitals を指標として画像読み込みの最適化する手法を簡単なコード付きで紹介しています。

半分ほどはブラウザが限定されていますが、手法として覚えておいても損はないかなという感じです。

- Responsive Layout
  - 画像に width 、 height を設定する
- Lazy Rendering
  - `content-visibility` を利用する
- AVIF
  - AVIF 形式の画像を利用する
- Load the right number of pixels
  - srcsetで画面サイズ毎に適切な画像を読み込む
- Caching / Immutable URLs
  - `cache-control` を利用する
- Lazy loading
  - `loading="lazy"` 属性を追加する
- Asynchronous decoding
  - `decoding="async"` 属性を追加する
- Blurry placeholder
  - `background-image` に blurry image を差し込む

---

### :focus-visible周りのブラウザ実装が進んだ

- 共有者: sakito

2月に`:focus-visible`まわりでブラウザの動きが多かったのでまとめました。


#### :focus-visibleおさらい

[:focus-visible](https://developer.mozilla.org/en-US/docs/Web/CSS/:focus-visible)は、タブ移動時のみ要素の`outline`が表示されるもの。`:focus`だと要素にクリック時やタブ移動時にフォーカスした際に`outline`が表示されるので、`outline`を消しがちだったがそれを避けることができる。

#### Chrome

[Chromeで:focus-visibleがUA style sheetのデフォルトに](https://groups.google.com/a/chromium.org/g/blink-dev/c/gv69rSngHDY)なりました。

Chrome 86から`:focus-visible`は使用できていたが、`UA style sheet`は`:forcus`だったので、下記のような記述が必要だった。

```css
:focus:not(:focus-visible) {
outline: 0;
}
```

今回の変更で`:focus-visible`がUA style sheetのデフォルトになったので上記の記述は不要になる。

この変更は[Chrome 90](https://www.chromestatus.com/features/5658873031557120)から入るぽいです。

#### Firefox

[Firefox 85で:focus-visibleが有効に](https://developer.mozilla.org/en-US/docs/Mozilla/Firefox/Releases/85#css)になりました。

いままで`:-moz-focusring`の疑似クラスを使用していたが、Firefox 85で`:focus-visible`が実装されました。
FirefoxDevToolsでスタイルの切り替えもできるようになっています。

#### Safari

[IgaliaがOpen Prioritizationを通して、WebKitに:focus-visibleを実装協力](https://blogs.igalia.com/mrego/2021/01/28/focus-visible-in-webkit-january-2021)

Igaliaが[Open Prioritization](https://www.igalia.com/open-prioritization/)というクラウドファンディングを通して、WebKitに`:focus-visible`を実装することになり、実装するためにWPTのテストを実装したり、実装するにあたった課題を報告している記事です。

上記でも紹介しているChromeで:focus-visibleがUA style sheetのデフォルトになっていないIssueを報告をしているのもIgaliaの人なのですが、このPJを通して発見されたものになります。

### [littledan/proposal-module-fragments](https://github.com/littledan/proposal-module-fragments)

- 共有者: @sosukesuzuki

3月の TC39 ミーティングで [@littledan](https://github.com/littledan) 氏から Module Fragments という Stage 0 のプロポーザルについて発表される予定です。

Module Fragments は次のようにインラインでモジュールを定義できる構文を導入します。

```js
module "#foo" {
  export let foo = "foo";
}

import { foo } from "#foo";
```

Module Fragments は主に webpack や Rollup、Parcel のようなモジュールバンドラーの出力として使われることを想定しています。

現在のモジュールバンドラーはいくつかの潜在的な問題を抱えています。

- ECMAScript Modules の仕様をエミュレートする必要があるため実装が複雑になる
  - しかも ECMAScript Modules に関連する仕様は増え続けるのでその度に追従するための実装をする必要がある
- 出力のコードにモジュール構造が残らずJavaScriptエンジンでの最適化に使うことができないので、パフォーマンスに悪影響が及ぶ可能性がある

モジュールバンドラーは Module Fragments を使ったコードを出力にすることでこれらの問題を解決することができます。

手前味噌ですがこれについて解説する記事を書いたので気になる方はご覧ください。

https://sosukesuzuki.dev/posts/stage-0-module-fragments/

---
