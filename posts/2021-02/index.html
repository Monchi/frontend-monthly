<!DOCTYPE html><html><head><title>Cybozu Frontend Monthly #8</title><meta name="description" content="サイボウズのフロントエンドエキスパートチームが月イチでお届けするフロントエンド情報"/><meta name="og:description" content="サイボウズのフロントエンドエキスパートチームが月イチでお届けするフロントエンド情報"/><meta name="og:title" content="Cybozu Frontend Monthly #8"/><meta name="og:type" content="website"/><meta name="og:image" content="https://cybozu.github.io/frontend-monthly/assets/img/header.png"/><meta name="twitter:title" content="Cybozu Frontend Monthly #8"/><meta name="twitter:description" content="サイボウズのフロントエンドエキスパートチームが月イチでお届けするフロントエンド情報"/><meta name="twitter:card" content="summary"/><meta name="twitter:creator" content="Cybozu Frontend Expert Team"/><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.21.0/themes/prism.min.css"/><meta name="next-head-count" content="14"/><link rel="preload" href="/frontend-monthly/_next/static/css/de019082f7bd6e5c1d8d.css" as="style"/><link rel="stylesheet" href="/frontend-monthly/_next/static/css/de019082f7bd6e5c1d8d.css" data-n-g=""/><link rel="preload" href="/frontend-monthly/_next/static/css/dfdf5f649880e41cbd5c.css" as="style"/><link rel="stylesheet" href="/frontend-monthly/_next/static/css/dfdf5f649880e41cbd5c.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/frontend-monthly/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/frontend-monthly/_next/static/chunks/webpack-377d9957422d331503bc.js" defer=""></script><script src="/frontend-monthly/_next/static/chunks/framework-92300432a1172ef1338b.js" defer=""></script><script src="/frontend-monthly/_next/static/chunks/main-7ae1bed21f7b794bd4c4.js" defer=""></script><script src="/frontend-monthly/_next/static/chunks/pages/_app-0eda503e19a294e1d1a6.js" defer=""></script><script src="/frontend-monthly/_next/static/chunks/423-4bcace61643c26d7ea4d.js" defer=""></script><script src="/frontend-monthly/_next/static/chunks/pages/posts/%5Bslug%5D-ef2fc0284b56e952f610.js" defer=""></script><script src="/frontend-monthly/_next/static/D_S-f2v3rZUXwnRGG-ZyZ/_buildManifest.js" defer=""></script><script src="/frontend-monthly/_next/static/D_S-f2v3rZUXwnRGG-ZyZ/_ssgManifest.js" defer=""></script></head><body><div id="__next"><style data-emotion="css crwfbk">.css-crwfbk{display:grid;grid-template-rows:auto 1fr auto;height:100vh;box-sizing:border-box;}.css-crwfbk .main{box-sizing:border-box;min-width:200px;max-width:980px;width:100%;margin:0 auto;padding:15px 45px;color:#24292e;}.css-crwfbk .main h1{margin-top:0;}@media (max-width: 767px){.css-crwfbk .main{padding:12px;font-size:14px;}.css-crwfbk .main .markdown-body{font-size:14px;}.css-crwfbk .main h1{font-size:1.55em;margin-bottom:0.25em;margin-top:0.5em;}.css-crwfbk .main h2{font-size:1.3em;margin-bottom:0.25em;margin-top:0.5em;}.css-crwfbk .main h3{font-size:1.1em;margin-bottom:0.25em;margin-top:0.5em;}.css-crwfbk .main hr{margin:12px 0;}}.css-crwfbk .footer{background-color:#31424e;text-align:center;color:#f8f8ff;font-size:0.75em;padding:5px 0;}.css-crwfbk .footer a{color:inherit;}</style><div class="markdown-body css-crwfbk"><main class="main"><style data-emotion="css e4jomx">.css-e4jomx .markdown-body img{border:1px solid rgba(0, 0, 0, 0.1);max-width:90%;height:auto;margin:12px auto;display:block;}.css-e4jomx .markdown-body li>p{margin:8px 0;}@media screen and (max-width: 420px){.css-e4jomx .markdown-body{font-size:14px;}.css-e4jomx .markdown-body li>p{margin:4px 0;}}.css-e4jomx h1{margin-top:0;}.css-e4jomx >h1:first-of-type{margin-top:0!important;}.css-e4jomx h3{position:relative;margin-left:-5px;padding-left:5px;}.css-e4jomx h3:hover .icon.icon-link{position:absolute;right:calc(100%);}.css-e4jomx h3:hover .icon.icon-link:before{font-size:0.75em;content:"🔗";}</style><article class="css-e4jomx"><h1>Cybozu Frontend Monthly #8</h1><div><img src="/frontend-monthly/assets/img/header.png" width="659" height="229" alt=""/></div><h2>イベント概要</h2><p><strong>サイボウズフロントエンドマンスリー</strong>は、サイボウズ社内で行っているフロントエンド情報共有会「フロントエンドウィークリー」の公開版です。</p><p>その月に気になったフロントエンドの情報を、サイボウズのフロントエンドエキスパートチームのメンバーが共有していきます。</p><p><strong>このイベントのハッシュタグは<!-- --> <a href="https://twitter.com/search?q=%23%E3%82%B5%E3%82%A4%E3%83%9C%E3%82%A6%E3%82%BA%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89%E3%83%9E%E3%83%B3%E3%82%B9%E3%83%AA%E3%83%BC" target="_blank" rel="noopener noreferrer">#サイボウズフロントエンドマンスリー</a> <!-- -->です。</strong></p><style data-emotion="css y47mw7">.css-y47mw7 h3{margin-top:0;}.css-y47mw7 p{margin-bottom:0;white-space:pre-line;}</style><pre class="css-y47mw7"><h3>※フロントエンドウィークリーとは</h3><p>毎週火曜の 17:00 〜 18:00 で社内向けに行っているフロントエンドの気になる記事を紹介する会です。2016年3月15日から行われています。<br/>ハッシュタグ<!-- --> <a href="https://twitter.com/search?q=%23%E3%82%B5%E3%82%A4%E3%83%9C%E3%82%A6%E3%82%BA%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89%E3%82%A6%E3%82%A3%E3%83%BC%E3%82%AF%E3%83%AA%E3%83%BC" target="_blank" rel="noopener noreferrer">#サイボウズフロントエンドウィークリー</a> <!-- -->で実況しています。</p></pre><h3>開催日</h3><p>2021年03月02日</p><h3>イベントページ</h3><p><a href="https://cybozu.connpass.com/event/205864/" target="_blank" rel="noopener noreferrer">https://cybozu.connpass.com/event/205864/</a></p><h3>配信URL</h3><style data-emotion="css 14br0ti">.css-14br0ti .embed{display:block;max-width:100%;max-height:280px;}</style><p class="css-14br0ti"><iframe title="https://www.youtube.com/embed/V-qsrYmUHjk" width="560" height="315" src="https://www.youtube.com/embed/V-qsrYmUHjk" frameBorder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" class="embed"></iframe><a href="https://www.youtube.com/watch?v=V-qsrYmUHjk" target="_blank" rel="noreferrer noopner">https://www.youtube.com/watch?v=V-qsrYmUHjk</a></p><h3>タイムテーブル</h3><table><tbody><tr><td>07:50 - 08:00</td><td>配信開始</td></tr><tr><td>08:00 - 08:05</td><td>オープニング</td></tr><tr><td>08:05 - 08:55</td><td>本編</td></tr><tr><td>08:55 - 09:00</td><td>クロージング</td></tr></tbody></table><h2>メンバー</h2><style data-emotion="css 1g63iqu">.css-1g63iqu{display:grid;grid-template-columns:repeat(auto-fill, minmax(120px, 1fr));grid-gap:24px 12px;padding:12px;}.css-1g63iqu .member{text-align:center;}.css-1g63iqu .thumbnail{border-radius:50%;margin:0 auto 5px;}</style><div class="css-1g63iqu"><div class="member"><img class="thumbnail" src="/frontend-monthly/assets/photo/f8079885d680213e64e4d706daa4a5ee_400x400.jpeg" width="100" height="100" alt=""/><a href="https://twitter.com/koba04" target="_blank" rel="noopener noreferrer">@koba04</a></div><div class="member"><img class="thumbnail" src="/frontend-monthly/assets/photo/a95b52be00e06cd293a6853bc36490bc_400x400.jpeg" width="100" height="100" alt=""/><a href="https://twitter.com/pirosikick" target="_blank" rel="noopener noreferrer">@pirosikick</a></div><div class="member"><img class="thumbnail" src="/frontend-monthly/assets/photo/erghEqaW_400x400.png" width="100" height="100" alt=""/><a href="https://twitter.com/__sakito__" target="_blank" rel="noopener noreferrer">@__sakito__</a></div><div class="member"><img class="thumbnail" src="/frontend-monthly/assets/photo/A9M8G6DH_400x400.jpg" width="100" height="100" alt=""/><a href="https://twitter.com/shisama_" target="_blank" rel="noopener noreferrer">@shisama_</a></div><div class="member"><img class="thumbnail" src="/frontend-monthly/assets/photo/EKNVNzOg_400x400.jpg" width="100" height="100" alt=""/><a href="https://twitter.com/nakajmg" target="_blank" rel="noopener noreferrer">@nakajmg</a></div><div class="member"><img class="thumbnail" src="/frontend-monthly/assets/photo/QySbTwnO_400x400.jpg" width="100" height="100" alt=""/><a href="https://twitter.com/b4h0_c4t" target="_blank" rel="noopener noreferrer">@b4h0_c4t</a></div><div class="member"><img class="thumbnail" src="/frontend-monthly/assets/photo/7iJNhdua_400x400.jpg" width="100" height="100" alt=""/><a href="https://twitter.com/__sosukesuzuki" target="_blank" rel="noopener noreferrer">@__sosukesuzuki</a></div></div><hr/><h2>紹介記事</h2><div class="markdown-body"><h3 id="smarthr-が-internet-explorer-サポート終了のお知らせを出した"><a href="#smarthr-%E3%81%8C-internet-explorer-%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E7%B5%82%E4%BA%86%E3%81%AE%E3%81%8A%E7%9F%A5%E3%82%89%E3%81%9B%E3%82%92%E5%87%BA%E3%81%97%E3%81%9F" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><a href="https://smarthr.jp/other/22512" target="_blank" rel="nofollow">SmartHR が Internet Explorer サポート終了のお知らせを出した</a></h3>
<ul>
<li>共有者: nakajmg</li>
</ul>
<p>Microsoft が自身のサービスでの IE サポート終了予定を発表してから、国内のサービスからもそれに追従するようにサポート終了のお知らせが出てきています。</p>
<p>SmartHR に続いて<a href="https://support.biz.moneyforward.com/valuepack/news/important/20210226.html" target="_blank" rel="nofollow">Money Forward も IE サポート終了のお知らせを出しました</a>。</p>
<p>背景として挙げているのはセキュリティ面、Microsoft Edge の存在、そして<a href="https://blogs.windows.com/japan/2020/08/18/microsoft-365-apps-say-farewell-to-internet-explorer-11/" target="_blank" rel="nofollow">Microsoft 365 における IE11 サポート終了の発表</a>です。
また、両者ともに IE サポートの終了月を Microsoft 365 の IE サポート終了の日に合わせて 2021 年 8 月までとしています。</p>
<p>今後もこの動きに追従する発表が出てきそうです。</p>
<p>(※追記) <a href="https://engineer.crowdworks.jp/entry/2021/02/18/120000" target="_blank" rel="nofollow">クラウドワークスさんも同時期に IE を推奨ブラウザから外すお知らせを出しています</a>。</p>
<hr>
<h3 id="using-abortcontroller-as-an-alternative-for-removing-event-listeners--css-tricks"><a href="#using-abortcontroller-as-an-alternative-for-removing-event-listeners--css-tricks" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><a href="https://css-tricks.com/using-abortcontroller-as-an-alternative-for-removing-event-listeners/" target="_blank" rel="nofollow">Using AbortController as an Alternative for Removing Event Listeners | CSS-Tricks</a></h3>
<ul>
<li>共有者: pirosikick</li>
</ul>
<p>AbortController を jQuery の once 関数みたいな一度実行したら消えるタイプのイベントリスナーの代替として使う話。
<code>mousemove</code>と<code>mouseup</code>のイベントハンドラを、<code>mouseup</code>時に両方削除するようなユースケースの場合、AbortController を使うとスッキリ書ける。</p>
<hr>
<h3 id="introducing-env-a-better-way-to-read-environment-variables-in-javascript---human-who-codes"><a href="#introducing-env-a-better-way-to-read-environment-variables-in-javascript---human-who-codes" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><a href="https://humanwhocodes.com/blog/2021/02/introducing-env-javascript-environment-variables/" target="_blank" rel="nofollow">Introducing Env: a better way to read environment variables in JavaScript - Human Who Codes</a></h3>
<ul>
<li>共有者: pirosikick</li>
</ul>
<p>ブラウザにサーバーサイドから環境変数を流し込む際に陥りがちな罠と、それを回避するために作られた<code>@humanwhocodes/env</code>について。
<code>env.required</code>や<code>env.exists</code>は Proxy で実装されている。
200 行くらいのシンプルなコードなので、<code>@humanwhocodes/env</code>を参考に自前で環境変数をラップしてアクセスする関数を作るのもよさそう。</p>
<hr>
<h3 id="maximally-optimizing-image-loading-for-the-web-in-2021"><a href="#maximally-optimizing-image-loading-for-the-web-in-2021" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><a href="https://www.industrialempathy.com/posts/image-optimizations/" target="_blank" rel="nofollow">Maximally optimizing image loading for the web in 2021</a></h3>
<ul>
<li>共有者: b4h0_c4t</li>
</ul>
<p>Core Web Vitals を指標として画像読み込みの最適化する手法を簡単なコード付きで紹介しています。</p>
<p>半分ほどはブラウザが限定されていますが、手法として覚えておいても損はないかなという感じです。</p>
<ul>
<li>Responsive Layout
<ul>
<li>画像に width 、 height を設定する</li>
</ul>
</li>
<li>Lazy Rendering
<ul>
<li><code>content-visibility</code> を利用する</li>
</ul>
</li>
<li>AVIF
<ul>
<li>AVIF 形式の画像を利用する</li>
</ul>
</li>
<li>Load the right number of pixels
<ul>
<li>srcset で画面サイズ毎に適切な画像を読み込む</li>
</ul>
</li>
<li>Caching / Immutable URLs
<ul>
<li><code>cache-control</code> を利用する</li>
</ul>
</li>
<li>Lazy loading
<ul>
<li><code>loading="lazy"</code> 属性を追加する</li>
</ul>
</li>
<li>Asynchronous decoding
<ul>
<li><code>decoding="async"</code> 属性を追加する</li>
</ul>
</li>
<li>Blurry placeholder
<ul>
<li><code>background-image</code> に blurry image を差し込む</li>
</ul>
</li>
</ul>
<hr>
<h3 id="focus-visible-周りのブラウザ実装が進んだ"><a href="#focus-visible-%E5%91%A8%E3%82%8A%E3%81%AE%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E5%AE%9F%E8%A3%85%E3%81%8C%E9%80%B2%E3%82%93%E3%81%A0" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>:focus-visible 周りのブラウザ実装が進んだ</h3>
<ul>
<li>共有者: sakito</li>
</ul>
<p>2 月に<code>:focus-visible</code>まわりでブラウザの動きが多かったのでまとめました。</p>
<h4 id="focus-visible-おさらい"><a href="#focus-visible-%E3%81%8A%E3%81%95%E3%82%89%E3%81%84" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>:focus-visible おさらい</h4>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/:focus-visible" target="_blank" rel="nofollow">:focus-visible</a>は、タブ移動時のみ要素の<code>outline</code>が表示されるもの。<code>:focus</code>だと要素にクリック時やタブ移動時にフォーカスした際に<code>outline</code>が表示されるので、<code>outline</code>を消しがちだったがそれを避けることができる。</p>
<h4 id="chrome"><a href="#chrome" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Chrome</h4>
<p><a href="https://groups.google.com/a/chromium.org/g/blink-dev/c/gv69rSngHDY" target="_blank" rel="nofollow">Chrome で:focus-visible が UA style sheet のデフォルトに</a>なりました。</p>
<p>Chrome 86 から<code>:focus-visible</code>は使用できていたが、<code>UA style sheet</code>は<code>:forcus</code>だったので、下記のような記述が必要だった。</p>
<div class="remark-highlight"><pre class="language-css"><code class="language-css"><span class="token selector"><span class="token pseudo-class">:focus</span><span class="token pseudo-class">:not</span><span class="token punctuation">(</span><span class="token pseudo-class">:focus-visible</span><span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
  <span class="token property">outline</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>今回の変更で<code>:focus-visible</code>が UA style sheet のデフォルトになったので上記の記述は不要になる。</p>
<p>この変更は<a href="https://www.chromestatus.com/features/5658873031557120" target="_blank" rel="nofollow">Chrome 90</a>から入るぽいです。</p>
<h4 id="firefox"><a href="#firefox" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Firefox</h4>
<p><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Firefox/Releases/85#css" target="_blank" rel="nofollow">Firefox 85 で:focus-visible が有効に</a>になりました。</p>
<p>いままで<code>:-moz-focusring</code>の疑似クラスを使用していたが、Firefox 85 で<code>:focus-visible</code>が実装されました。
FirefoxDevTools でスタイルの切り替えもできるようになっています。</p>
<h4 id="safari"><a href="#safari" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Safari</h4>
<p><a href="https://blogs.igalia.com/mrego/2021/01/28/focus-visible-in-webkit-january-2021" target="_blank" rel="nofollow">Igalia が Open Prioritization を通して、WebKit に:focus-visible を実装協力</a></p>
<p>Igalia が<a href="https://www.igalia.com/open-prioritization/" target="_blank" rel="nofollow">Open Prioritization</a>というクラウドファンディングを通して、WebKit に<code>:focus-visible</code>を実装することになり、実装するために WPT のテストを実装したり、実装するにあたった課題を報告している記事です。</p>
<p>上記でも紹介している Chrome で:focus-visible が UA style sheet のデフォルトになっていない Issue を報告をしているのも Igalia の人なのですが、この PJ を通して発見されたものになります。</p>
<h3 id="littledanproposal-module-fragments"><a href="#littledanproposal-module-fragments" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><a href="https://github.com/littledan/proposal-module-fragments" target="_blank" rel="nofollow">littledan/proposal-module-fragments</a></h3>
<ul>
<li>共有者: @sosukesuzuki</li>
</ul>
<p>3 月の TC39 ミーティングで <a href="https://github.com/littledan" target="_blank" rel="nofollow">@littledan</a> 氏から Module Fragments という Stage 0 のプロポーザルについて発表される予定です。</p>
<p>Module Fragments は次のようにインラインでモジュールを定義できる構文を導入します。</p>
<div class="remark-highlight"><pre class="language-js"><code class="language-js">module <span class="token string">"#foo"</span> <span class="token punctuation">{</span>
  <span class="token keyword module">export</span> <span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token string">"foo"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> foo <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">"#foo"</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Module Fragments は主に webpack や Rollup、Parcel のようなモジュールバンドラーの出力として使われることを想定しています。</p>
<p>現在のモジュールバンドラーはいくつかの潜在的な問題を抱えています。</p>
<ul>
<li>ECMAScript Modules の仕様をエミュレートする必要があるため実装が複雑になる
<ul>
<li>しかも ECMAScript Modules に関連する仕様は増え続けるのでその度に追従するための実装をする必要がある</li>
</ul>
</li>
<li>出力のコードにモジュール構造が残らず JavaScript エンジンでの最適化に使うことができないので、パフォーマンスに悪影響が及ぶ可能性がある</li>
</ul>
<p>モジュールバンドラーは Module Fragments を使ったコードを出力にすることでこれらの問題を解決することができます。</p>
<p>手前味噌ですがこれについて解説する記事を書いたので気になる方はご覧ください。</p>
<p><a href="https://sosukesuzuki.dev/posts/stage-0-module-fragments/" target="_blank" rel="nofollow">https://sosukesuzuki.dev/posts/stage-0-module-fragments/</a></p>
<hr>
<h3 id="requesting-performance-isolation-with-the-origin-agent-cluster-header"><a href="#requesting-performance-isolation-with-the-origin-agent-cluster-header" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a><a href="https://web.dev/origin-agent-cluster/" target="_blank" rel="nofollow">Requesting performance isolation with the Origin-Agent-Cluster header</a></h3>
<ul>
<li>共有者: shisama_</li>
</ul>
<p>Site Isolation の Origin で Isolation するための機能の話です。
HTTP レスポンスヘッダとして<code>Origin-Agent-Cluster: ?1</code>を返すことで iframe で埋め込まれた Same-site cross-origin なページをプロセスレベルで分離することが可能になります。</p>
<p>たとえば、<code>https://mail.example.com</code> の中に iframe を使って <code>https://chat.example.com</code> が埋め込まれていたとします。
両者はサブドメインは違えど eTLD+1 は同じなので SameSite となります。Site Isolation は Same-site であればプロセスは 1 つのため、メモリ管理も同じプロセス内で行われます。</p>
<p>そのため、一方に XSS が埋め込まれてメモリにアクセスできれば、サイドチャネル攻撃により情報を盗まれる可能性があります。
Origin レベルで分離することで Same-site でも Cross-origin の場合でも一方に脆弱性があってももう一方への影響を防ぐことができます。
<code>Origin-Agent-Cluster</code> が有効になっている場合、次のことができなくなります。</p>
<ul>
<li>document.domain = "example.com" をしても何もしない。書き換えないだけで例外は投げない</li>
<li><code>postMessage()</code> による <code>WebAssembly.Module</code> を Cross-origin のページに送信できない</li>
<li><code>SharedArrayBuffer</code> や <code>WebAssembly.Memory</code> を Cross-origin のページに送信できない</li>
</ul>
<p>プロセスが同じだと iframe で埋め込んだページがリソースを使いまくっていた場合、埋め込み元のページにも影響していました。しかし、プロセスが分離されると、埋め込み元のことを気にしなくても良くなるといったパフォーマンスの改善にもつながります。<br>
埋め込み先が重くても埋め込み元は影響を受けない。<br>
ただ、パフォーマンスに関しても本当に速くなるのかは実際動かして確認したほうがいいとのことです。</p>
<p>ただし、<code>Origin-Agent-Cluster</code> はセキュリティに関する HTTP ヘッダではない、とこの記事には書かれています。次のような理由から origin-keyed agent cluster がセキュリティ機能として考えないほうがいいとされています。その代わり、リソースを分離することでブラウザにリソース割当の優先度決めを助長する方法として考えられます。</p>
<ul>
<li>Firefox や Safari では iframe ごとのプロセスの分離が実装されていない</li>
<li>リソースが限られている Android ではできるだけプロセスを増やさないようにしている
<ul>
<li>Site Isolation もパスワード画面など一部でしか適用されていない</li>
</ul>
</li>
<li>ブラウザはプロセスの分離ではなく、スレッドによる分離などを優先して利用するかもしれない</li>
<li>サイト全体ではなく一部のページにのみ <code>Origin-Agent-Cluster</code> が適用されていた場合、適用されていないページを踏むとブラウザはその Origin を origin keyed cluster としてみなさない</li>
</ul>
<details>
<summary><strong>その他参考文献</strong></summary>
<ul>
<li><a href="https://blog.jxck.io/entries/2020-05-22/site-isolation.html" target="_blank" rel="nofollow">Site Isolation 及び Web のセキュリティモデルの更新 | blog.jxck.io</a>
<ul>
<li>Site Isolation から Origin Isolation までの流れが紹介されています</li>
<li>それぞれの参考リンクが網羅的に紹介されています。</li>
</ul>
</li>
<li><a href="https://mozaic.fm/episodes/63/cross-origin-info-leaks.html" target="_blank" rel="nofollow">ep63 Cross Origin Info Leaks | mozaic.fm</a>
<ul>
<li>Origin Isolation については mozaic.fm ep63 00:55 ぐらいから解説されてました</li>
</ul>
</li>
<li><a href="https://github.com/whatwg/html/pull/6214" target="_blank" rel="nofollow">Rename <code>Origin-Isolation</code> to <code>Origin-Agent-Cluster</code> by domenic · Pull Request #6214 · whatwg/html</a>
<ul>
<li>元々 "Origin Isolation" という名前で仕様策定されていたので、調査するときは "Origin Isolation" で調べても良さそうです。</li>
</ul>
</details>
</li>
</ul>
<hr>
</div><h2>フロントエンドエキスパートチームについて</h2><style data-emotion="css gz8dae">.css-gz8dae{padding:20px;}</style><div class="css-gz8dae"></div><p style="margin-bottom:0"><a href="https://speakerdeck.com/cybozuinsideout/frontendexpert-team" target="_blank" rel="nofollow noopener noreferrer">https://speakerdeck.com/cybozuinsideout/frontendexpert-team</a></p></article></main><footer class="footer"><a href="/frontend-monthly/">Cybozu Frontend Monthly</a></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"membersPhotoUrl":{"@koba04":"/assets/photo/f8079885d680213e64e4d706daa4a5ee_400x400.jpeg","@pirosikick":"/assets/photo/a95b52be00e06cd293a6853bc36490bc_400x400.jpeg","@__sakito__":"/assets/photo/erghEqaW_400x400.png","@shisama_":"/assets/photo/A9M8G6DH_400x400.jpg","@nakajmg":"/assets/photo/EKNVNzOg_400x400.jpg","@b4h0_c4t":"/assets/photo/QySbTwnO_400x400.jpg","@__sosukesuzuki":"/assets/photo/7iJNhdua_400x400.jpg"},"frontmatter":{"title":"Cybozu Frontend Monthly","date":"2021-03-02T17:00:00+09:00","slug":"2021-02","connpass":"https://cybozu.connpass.com/event/205864/","streamUrl":"https://www.youtube.com/watch?v=V-qsrYmUHjk","no":8,"members":[{"name":"@koba04","link":"https://twitter.com/koba04"},{"name":"@pirosikick","link":"https://twitter.com/pirosikick"},{"name":"@__sakito__","link":"https://twitter.com/__sakito__"},{"name":"@shisama_","link":"https://twitter.com/shisama_"},{"name":"@nakajmg","link":"https://twitter.com/nakajmg"},{"name":"@b4h0_c4t","link":"https://twitter.com/b4h0_c4t"},{"name":"@__sosukesuzuki","link":"https://twitter.com/__sosukesuzuki"}],"guest":null},"html":"\u003ch3 id=\"smarthr-が-internet-explorer-サポート終了のお知らせを出した\"\u003e\u003ca href=\"#smarthr-%E3%81%8C-internet-explorer-%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88%E7%B5%82%E4%BA%86%E3%81%AE%E3%81%8A%E7%9F%A5%E3%82%89%E3%81%9B%E3%82%92%E5%87%BA%E3%81%97%E3%81%9F\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e\u003ca href=\"https://smarthr.jp/other/22512\" target=\"_blank\" rel=\"nofollow\"\u003eSmartHR が Internet Explorer サポート終了のお知らせを出した\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e共有者: nakajmg\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eMicrosoft が自身のサービスでの IE サポート終了予定を発表してから、国内のサービスからもそれに追従するようにサポート終了のお知らせが出てきています。\u003c/p\u003e\n\u003cp\u003eSmartHR に続いて\u003ca href=\"https://support.biz.moneyforward.com/valuepack/news/important/20210226.html\" target=\"_blank\" rel=\"nofollow\"\u003eMoney Forward も IE サポート終了のお知らせを出しました\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e背景として挙げているのはセキュリティ面、Microsoft Edge の存在、そして\u003ca href=\"https://blogs.windows.com/japan/2020/08/18/microsoft-365-apps-say-farewell-to-internet-explorer-11/\" target=\"_blank\" rel=\"nofollow\"\u003eMicrosoft 365 における IE11 サポート終了の発表\u003c/a\u003eです。\nまた、両者ともに IE サポートの終了月を Microsoft 365 の IE サポート終了の日に合わせて 2021 年 8 月までとしています。\u003c/p\u003e\n\u003cp\u003e今後もこの動きに追従する発表が出てきそうです。\u003c/p\u003e\n\u003cp\u003e(※追記) \u003ca href=\"https://engineer.crowdworks.jp/entry/2021/02/18/120000\" target=\"_blank\" rel=\"nofollow\"\u003eクラウドワークスさんも同時期に IE を推奨ブラウザから外すお知らせを出しています\u003c/a\u003e。\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 id=\"using-abortcontroller-as-an-alternative-for-removing-event-listeners--css-tricks\"\u003e\u003ca href=\"#using-abortcontroller-as-an-alternative-for-removing-event-listeners--css-tricks\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e\u003ca href=\"https://css-tricks.com/using-abortcontroller-as-an-alternative-for-removing-event-listeners/\" target=\"_blank\" rel=\"nofollow\"\u003eUsing AbortController as an Alternative for Removing Event Listeners | CSS-Tricks\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e共有者: pirosikick\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAbortController を jQuery の once 関数みたいな一度実行したら消えるタイプのイベントリスナーの代替として使う話。\n\u003ccode\u003emousemove\u003c/code\u003eと\u003ccode\u003emouseup\u003c/code\u003eのイベントハンドラを、\u003ccode\u003emouseup\u003c/code\u003e時に両方削除するようなユースケースの場合、AbortController を使うとスッキリ書ける。\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 id=\"introducing-env-a-better-way-to-read-environment-variables-in-javascript---human-who-codes\"\u003e\u003ca href=\"#introducing-env-a-better-way-to-read-environment-variables-in-javascript---human-who-codes\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e\u003ca href=\"https://humanwhocodes.com/blog/2021/02/introducing-env-javascript-environment-variables/\" target=\"_blank\" rel=\"nofollow\"\u003eIntroducing Env: a better way to read environment variables in JavaScript - Human Who Codes\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e共有者: pirosikick\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eブラウザにサーバーサイドから環境変数を流し込む際に陥りがちな罠と、それを回避するために作られた\u003ccode\u003e@humanwhocodes/env\u003c/code\u003eについて。\n\u003ccode\u003eenv.required\u003c/code\u003eや\u003ccode\u003eenv.exists\u003c/code\u003eは Proxy で実装されている。\n200 行くらいのシンプルなコードなので、\u003ccode\u003e@humanwhocodes/env\u003c/code\u003eを参考に自前で環境変数をラップしてアクセスする関数を作るのもよさそう。\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 id=\"maximally-optimizing-image-loading-for-the-web-in-2021\"\u003e\u003ca href=\"#maximally-optimizing-image-loading-for-the-web-in-2021\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e\u003ca href=\"https://www.industrialempathy.com/posts/image-optimizations/\" target=\"_blank\" rel=\"nofollow\"\u003eMaximally optimizing image loading for the web in 2021\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e共有者: b4h0_c4t\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eCore Web Vitals を指標として画像読み込みの最適化する手法を簡単なコード付きで紹介しています。\u003c/p\u003e\n\u003cp\u003e半分ほどはブラウザが限定されていますが、手法として覚えておいても損はないかなという感じです。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eResponsive Layout\n\u003cul\u003e\n\u003cli\u003e画像に width 、 height を設定する\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eLazy Rendering\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003econtent-visibility\u003c/code\u003e を利用する\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eAVIF\n\u003cul\u003e\n\u003cli\u003eAVIF 形式の画像を利用する\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eLoad the right number of pixels\n\u003cul\u003e\n\u003cli\u003esrcset で画面サイズ毎に適切な画像を読み込む\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eCaching / Immutable URLs\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ecache-control\u003c/code\u003e を利用する\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eLazy loading\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eloading=\"lazy\"\u003c/code\u003e 属性を追加する\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eAsynchronous decoding\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003edecoding=\"async\"\u003c/code\u003e 属性を追加する\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eBlurry placeholder\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ebackground-image\u003c/code\u003e に blurry image を差し込む\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 id=\"focus-visible-周りのブラウザ実装が進んだ\"\u003e\u003ca href=\"#focus-visible-%E5%91%A8%E3%82%8A%E3%81%AE%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E5%AE%9F%E8%A3%85%E3%81%8C%E9%80%B2%E3%82%93%E3%81%A0\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e:focus-visible 周りのブラウザ実装が進んだ\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e共有者: sakito\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e2 月に\u003ccode\u003e:focus-visible\u003c/code\u003eまわりでブラウザの動きが多かったのでまとめました。\u003c/p\u003e\n\u003ch4 id=\"focus-visible-おさらい\"\u003e\u003ca href=\"#focus-visible-%E3%81%8A%E3%81%95%E3%82%89%E3%81%84\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e:focus-visible おさらい\u003c/h4\u003e\n\u003cp\u003e\u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/:focus-visible\" target=\"_blank\" rel=\"nofollow\"\u003e:focus-visible\u003c/a\u003eは、タブ移動時のみ要素の\u003ccode\u003eoutline\u003c/code\u003eが表示されるもの。\u003ccode\u003e:focus\u003c/code\u003eだと要素にクリック時やタブ移動時にフォーカスした際に\u003ccode\u003eoutline\u003c/code\u003eが表示されるので、\u003ccode\u003eoutline\u003c/code\u003eを消しがちだったがそれを避けることができる。\u003c/p\u003e\n\u003ch4 id=\"chrome\"\u003e\u003ca href=\"#chrome\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eChrome\u003c/h4\u003e\n\u003cp\u003e\u003ca href=\"https://groups.google.com/a/chromium.org/g/blink-dev/c/gv69rSngHDY\" target=\"_blank\" rel=\"nofollow\"\u003eChrome で:focus-visible が UA style sheet のデフォルトに\u003c/a\u003eなりました。\u003c/p\u003e\n\u003cp\u003eChrome 86 から\u003ccode\u003e:focus-visible\u003c/code\u003eは使用できていたが、\u003ccode\u003eUA style sheet\u003c/code\u003eは\u003ccode\u003e:forcus\u003c/code\u003eだったので、下記のような記述が必要だった。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-css\"\u003e\u003ccode class=\"language-css\"\u003e\u003cspan class=\"token selector\"\u003e\u003cspan class=\"token pseudo-class\"\u003e:focus\u003c/span\u003e\u003cspan class=\"token pseudo-class\"\u003e:not\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token pseudo-class\"\u003e:focus-visible\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token property\"\u003eoutline\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e今回の変更で\u003ccode\u003e:focus-visible\u003c/code\u003eが UA style sheet のデフォルトになったので上記の記述は不要になる。\u003c/p\u003e\n\u003cp\u003eこの変更は\u003ca href=\"https://www.chromestatus.com/features/5658873031557120\" target=\"_blank\" rel=\"nofollow\"\u003eChrome 90\u003c/a\u003eから入るぽいです。\u003c/p\u003e\n\u003ch4 id=\"firefox\"\u003e\u003ca href=\"#firefox\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eFirefox\u003c/h4\u003e\n\u003cp\u003e\u003ca href=\"https://developer.mozilla.org/en-US/docs/Mozilla/Firefox/Releases/85#css\" target=\"_blank\" rel=\"nofollow\"\u003eFirefox 85 で:focus-visible が有効に\u003c/a\u003eになりました。\u003c/p\u003e\n\u003cp\u003eいままで\u003ccode\u003e:-moz-focusring\u003c/code\u003eの疑似クラスを使用していたが、Firefox 85 で\u003ccode\u003e:focus-visible\u003c/code\u003eが実装されました。\nFirefoxDevTools でスタイルの切り替えもできるようになっています。\u003c/p\u003e\n\u003ch4 id=\"safari\"\u003e\u003ca href=\"#safari\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003eSafari\u003c/h4\u003e\n\u003cp\u003e\u003ca href=\"https://blogs.igalia.com/mrego/2021/01/28/focus-visible-in-webkit-january-2021\" target=\"_blank\" rel=\"nofollow\"\u003eIgalia が Open Prioritization を通して、WebKit に:focus-visible を実装協力\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eIgalia が\u003ca href=\"https://www.igalia.com/open-prioritization/\" target=\"_blank\" rel=\"nofollow\"\u003eOpen Prioritization\u003c/a\u003eというクラウドファンディングを通して、WebKit に\u003ccode\u003e:focus-visible\u003c/code\u003eを実装することになり、実装するために WPT のテストを実装したり、実装するにあたった課題を報告している記事です。\u003c/p\u003e\n\u003cp\u003e上記でも紹介している Chrome で:focus-visible が UA style sheet のデフォルトになっていない Issue を報告をしているのも Igalia の人なのですが、この PJ を通して発見されたものになります。\u003c/p\u003e\n\u003ch3 id=\"littledanproposal-module-fragments\"\u003e\u003ca href=\"#littledanproposal-module-fragments\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e\u003ca href=\"https://github.com/littledan/proposal-module-fragments\" target=\"_blank\" rel=\"nofollow\"\u003elittledan/proposal-module-fragments\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e共有者: @sosukesuzuki\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e3 月の TC39 ミーティングで \u003ca href=\"https://github.com/littledan\" target=\"_blank\" rel=\"nofollow\"\u003e@littledan\u003c/a\u003e 氏から Module Fragments という Stage 0 のプロポーザルについて発表される予定です。\u003c/p\u003e\n\u003cp\u003eModule Fragments は次のようにインラインでモジュールを定義できる構文を導入します。\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-js\"\u003e\u003ccode class=\"language-js\"\u003emodule \u003cspan class=\"token string\"\u003e\"#foo\"\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e foo \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"foo\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eimport\u003c/span\u003e \u003cspan class=\"token imports\"\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e foo \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token keyword module\"\u003efrom\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"#foo\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eModule Fragments は主に webpack や Rollup、Parcel のようなモジュールバンドラーの出力として使われることを想定しています。\u003c/p\u003e\n\u003cp\u003e現在のモジュールバンドラーはいくつかの潜在的な問題を抱えています。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eECMAScript Modules の仕様をエミュレートする必要があるため実装が複雑になる\n\u003cul\u003e\n\u003cli\u003eしかも ECMAScript Modules に関連する仕様は増え続けるのでその度に追従するための実装をする必要がある\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e出力のコードにモジュール構造が残らず JavaScript エンジンでの最適化に使うことができないので、パフォーマンスに悪影響が及ぶ可能性がある\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eモジュールバンドラーは Module Fragments を使ったコードを出力にすることでこれらの問題を解決することができます。\u003c/p\u003e\n\u003cp\u003e手前味噌ですがこれについて解説する記事を書いたので気になる方はご覧ください。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://sosukesuzuki.dev/posts/stage-0-module-fragments/\" target=\"_blank\" rel=\"nofollow\"\u003ehttps://sosukesuzuki.dev/posts/stage-0-module-fragments/\u003c/a\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 id=\"requesting-performance-isolation-with-the-origin-agent-cluster-header\"\u003e\u003ca href=\"#requesting-performance-isolation-with-the-origin-agent-cluster-header\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan class=\"icon icon-link\"\u003e\u003c/span\u003e\u003c/a\u003e\u003ca href=\"https://web.dev/origin-agent-cluster/\" target=\"_blank\" rel=\"nofollow\"\u003eRequesting performance isolation with the Origin-Agent-Cluster header\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e共有者: shisama_\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eSite Isolation の Origin で Isolation するための機能の話です。\nHTTP レスポンスヘッダとして\u003ccode\u003eOrigin-Agent-Cluster: ?1\u003c/code\u003eを返すことで iframe で埋め込まれた Same-site cross-origin なページをプロセスレベルで分離することが可能になります。\u003c/p\u003e\n\u003cp\u003eたとえば、\u003ccode\u003ehttps://mail.example.com\u003c/code\u003e の中に iframe を使って \u003ccode\u003ehttps://chat.example.com\u003c/code\u003e が埋め込まれていたとします。\n両者はサブドメインは違えど eTLD+1 は同じなので SameSite となります。Site Isolation は Same-site であればプロセスは 1 つのため、メモリ管理も同じプロセス内で行われます。\u003c/p\u003e\n\u003cp\u003eそのため、一方に XSS が埋め込まれてメモリにアクセスできれば、サイドチャネル攻撃により情報を盗まれる可能性があります。\nOrigin レベルで分離することで Same-site でも Cross-origin の場合でも一方に脆弱性があってももう一方への影響を防ぐことができます。\n\u003ccode\u003eOrigin-Agent-Cluster\u003c/code\u003e が有効になっている場合、次のことができなくなります。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003edocument.domain = \"example.com\" をしても何もしない。書き換えないだけで例外は投げない\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003epostMessage()\u003c/code\u003e による \u003ccode\u003eWebAssembly.Module\u003c/code\u003e を Cross-origin のページに送信できない\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eSharedArrayBuffer\u003c/code\u003e や \u003ccode\u003eWebAssembly.Memory\u003c/code\u003e を Cross-origin のページに送信できない\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eプロセスが同じだと iframe で埋め込んだページがリソースを使いまくっていた場合、埋め込み元のページにも影響していました。しかし、プロセスが分離されると、埋め込み元のことを気にしなくても良くなるといったパフォーマンスの改善にもつながります。\u003cbr\u003e\n埋め込み先が重くても埋め込み元は影響を受けない。\u003cbr\u003e\nただ、パフォーマンスに関しても本当に速くなるのかは実際動かして確認したほうがいいとのことです。\u003c/p\u003e\n\u003cp\u003eただし、\u003ccode\u003eOrigin-Agent-Cluster\u003c/code\u003e はセキュリティに関する HTTP ヘッダではない、とこの記事には書かれています。次のような理由から origin-keyed agent cluster がセキュリティ機能として考えないほうがいいとされています。その代わり、リソースを分離することでブラウザにリソース割当の優先度決めを助長する方法として考えられます。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eFirefox や Safari では iframe ごとのプロセスの分離が実装されていない\u003c/li\u003e\n\u003cli\u003eリソースが限られている Android ではできるだけプロセスを増やさないようにしている\n\u003cul\u003e\n\u003cli\u003eSite Isolation もパスワード画面など一部でしか適用されていない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eブラウザはプロセスの分離ではなく、スレッドによる分離などを優先して利用するかもしれない\u003c/li\u003e\n\u003cli\u003eサイト全体ではなく一部のページにのみ \u003ccode\u003eOrigin-Agent-Cluster\u003c/code\u003e が適用されていた場合、適用されていないページを踏むとブラウザはその Origin を origin keyed cluster としてみなさない\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdetails\u003e\n\u003csummary\u003e\u003cstrong\u003eその他参考文献\u003c/strong\u003e\u003c/summary\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://blog.jxck.io/entries/2020-05-22/site-isolation.html\" target=\"_blank\" rel=\"nofollow\"\u003eSite Isolation 及び Web のセキュリティモデルの更新 | blog.jxck.io\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003eSite Isolation から Origin Isolation までの流れが紹介されています\u003c/li\u003e\n\u003cli\u003eそれぞれの参考リンクが網羅的に紹介されています。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://mozaic.fm/episodes/63/cross-origin-info-leaks.html\" target=\"_blank\" rel=\"nofollow\"\u003eep63 Cross Origin Info Leaks | mozaic.fm\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003eOrigin Isolation については mozaic.fm ep63 00:55 ぐらいから解説されてました\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/whatwg/html/pull/6214\" target=\"_blank\" rel=\"nofollow\"\u003eRename \u003ccode\u003eOrigin-Isolation\u003c/code\u003e to \u003ccode\u003eOrigin-Agent-Cluster\u003c/code\u003e by domenic · Pull Request #6214 · whatwg/html\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e元々 \"Origin Isolation\" という名前で仕様策定されていたので、調査するときは \"Origin Isolation\" で調べても良さそうです。\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/details\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n"},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"2021-02"},"buildId":"D_S-f2v3rZUXwnRGG-ZyZ","assetPrefix":"/frontend-monthly","runtimeConfig":{"basePath":"/frontend-monthly"},"isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>